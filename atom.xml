<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>YanChen</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xiaowuyoucy.github.io/"/>
  <updated>2022-05-17T19:22:41.406Z</updated>
  <id>https://xiaowuyoucy.github.io/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Git教程</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/17/Git%E6%95%99%E7%A8%8B/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/17/Git教程/</id>
    <published>2022-05-17T14:55:09.000Z</published>
    <updated>2022-05-17T19:22:41.406Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>项目介绍和部署</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/17/%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E5%92%8C%E9%83%A8%E7%BD%B2/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/17/项目介绍和部署/</id>
    <published>2022-05-17T14:36:46.000Z</published>
    <updated>2022-05-17T19:22:38.846Z</updated>
    
    <content type="html"><![CDATA[<p><strong>第一天</strong> <strong>-</strong> <strong>项目介绍和部署</strong></p><ol><li><p>学习目标</p></li><li><p>项目阶段要求</p><ul><li>2.1 项目1 介绍</li><li>2.2 项目要求</li></ul></li><li><p>项目整体架构图</p></li><li><p>项目整体模块划分</p></li><li><p>数据的加密和解密</p><ul><li>5.1 加密三要素</li><li>5.2 常用的加密方式</li><li>5.3 常用的加密算法</li></ul></li><li><p>安装OpenSSL</p></li></ol><p>6.1 openssl介绍</p><p>6.2 安装</p><ol start="7"><li><p>Oracle数据库表的导入</p><ul><li>7.1 连接数据库前的准备工作</li><li>7.2 启动oracle数据库</li></ul></li><li><p>源码安装</p></li></ol><h1 id="第一天-项目介绍和部署"><a class="markdownIt-Anchor" href="#第一天-项目介绍和部署"></a> 第一天 - 项目介绍和部署</h1><p>第一天 - 项目介绍和部署</p><ol><li><p>学习目标<br>理解项目的整体功能, 细节无需明白, 后边会详细讲解<br>清楚项目整体模块划分和后续要实现的功能<br>完成项目所需的oracle数据表的导入<br>Windows/Linux下完成OpenSSL的安装<br>对加密相关概念有初步理解(后续会逐步深入讲解)</p></li><li><p>项目阶段要求<br>2.1 项目1 介绍</p></li><li><p>项目名称 - 数据安全传输 基础设施平台<br>写简历的时候需要自己起个名字(根据项目的功能) 2. 应用场景:<br>网络通信<br>socket<br>http<br>传输层使用的tcp<br>保证通信时数据的安全<br>数据加密方式<br>对称加密</p></li></ol><p>非对称加密<br>项目1实现的功能<br>秘钥生成, 校验<br>数据加密</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;第一天&lt;/strong&gt; &lt;strong&gt;-&lt;/strong&gt; &lt;strong&gt;项目介绍和部署&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;学习目标&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;项目阶段要求&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2.1 项目1 介绍&lt;/
      
    
    </summary>
    
      <category term="cpp" scheme="https://xiaowuyoucy.github.io/categories/cpp/"/>
    
    
  </entry>
  
  <entry>
    <title>OpenSSL安装和配置</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/17/OpenSSL%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/17/OpenSSL安装和配置/</id>
    <published>2022-05-16T23:12:06.000Z</published>
    <updated>2022-05-16T23:19:36.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-安装"><a class="markdownIt-Anchor" href="#1-安装"></a> 1. 安装</h2><h3 id="11-windows下安装openssl"><a class="markdownIt-Anchor" href="#11-windows下安装openssl"></a> 1.1 windows下安装openssl</h3><img src="/images/javawz/snipaste_20180423_165811.png" width="70%"><img src="/images/javawz/snipaste_20180423_170056.png" width="70%"><img src="/images/javawz/snipaste_20180423_170304.png" width="70%"><img src="/images/javawz/1524474316039.png" width="70%"><img src="/images/javawz/snipaste_20180423_170806.png" width="70%"><p>恭喜，OpenSSL安装完成。</p><h3 id="12-linux下安装openssl"><a class="markdownIt-Anchor" href="#12-linux下安装openssl"></a> 1.2 Linux下安装OpenSSL</h3><ol><li><p>下载安装包, 下载地址:  <a href="https://github.com/openssl/openssl" target="_blank" rel="noopener">https://github.com/openssl/openssl</a></p></li><li><p>源码安装包解压缩</p><ul><li><p>.zip格式:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip openssl.zip</span><br></pre></td></tr></table></figure></li><li><p>.tar.gz格式:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf openssl.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>.tar.bz格式:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar jxvf openssl.tar.gz</span><br></pre></td></tr></table></figure></li></ul></li><li><p>进入解压目录, 安装（可参考安装文件INSTALL）:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./config</span><br><span class="line">make</span><br><span class="line">make test （可选）</span><br><span class="line">make install (使用管理员权限执行该命令)</span><br><span class="line">sudo ldconfig    更新动态库配置文件</span><br></pre></td></tr></table></figure></li><li><p>验证是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version -a</span><br></pre></td></tr></table></figure><blockquote><p>输出结果</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OpenSSL 1.1.1-pre6-dev  xx XXX xxxx</span><br><span class="line">built on: Mon Apr 23 10:53:02 2018 UTC</span><br><span class="line">platform: linux-x86_64</span><br><span class="line">options:  bn(64,64) rc4(16x,int) des(int) idea(int) blowfish(ptr) </span><br><span class="line">compiler: gcc -fPIC -pthread -m64  -Wa,--noexecstack -Wall -O3 -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_CPUID_OBJ -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DRC4_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DGHASH_ASM -DECP_NISTZ256_ASM -DX25519_ASM -DPADLOCK_ASM -DPOLY1305_ASM -DNDEBUG</span><br><span class="line">OPENSSLDIR: "/usr/local/ssl"</span><br><span class="line">ENGINESDIR: "/usr/local/lib64/engines-1.1"</span><br><span class="line">Seeding source: os-specific</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-vs中使用openssl"><a class="markdownIt-Anchor" href="#2-vs中使用openssl"></a> 2  VS中使用openssl</h2><blockquote><p>打开VS, 创建一个空的控制台应用程序</p></blockquote><img src="/images/javawz/snipaste_20180423_171324.png" width="70%"><blockquote><p>设置项目属性, 打开项目的属性面板</p></blockquote><img src="/images/javawz/snipaste_20180423_172055.png" width="100%"><blockquote><p>添加openssl头文件目录</p></blockquote><img src="/images/javawz/snipaste_20180423_172323.png" width="90%"><img src="/images/javawz/snipaste_20180423_172654.png" width="60%"><blockquote><p>添加openssl的库目录</p></blockquote><img src="/images/javawz/snipaste_20180423_172940.png" width="90%"><blockquote><p>配置完毕</p></blockquote><img src="/images/javawz/snipaste_20180423_173043.png" width="90%"><h2 id="3-测试"><a class="markdownIt-Anchor" href="#3-测试"></a> 3. 测试</h2><p>###3.1 VS中的相关设置</p><blockquote><p>打开项目属性窗口, 添加openssl相关的库到项目中</p><p><mark><strong>项目属性 -&gt; 链接器 -&gt; 输入 -&gt; 附件依赖项</strong></mark></p><ul><li><strong>libssl.lib</strong></li><li><strong>libcrypto.lib</strong></li></ul></blockquote><img src="/images/javawz/snipaste_20180423_174217.png" width="90%"><img src="/images/javawz/snipaste_20180423_174437.png" width="90%"><blockquote><p>将openssl安装目录/bin目录下(<strong>C:\OpenSSL-Win32\bin</strong>)的两个动态库拷贝到工作目录下:</p><ul><li><strong>libcrypto-1_1.dll</strong></li><li><strong>libssl-1_1.dll</strong></li></ul><p><mark><strong>C:\OpenSSL-Win32 是我的openssl安装目录</strong></mark></p><p>如图所示:</p><img src="/images/javawz/snipaste_20180423_182257.png" width="50%"></blockquote><p>测试代码如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/md5.h&gt;// md5 头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getMD5</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str, <span class="keyword">char</span>* result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">MD5_CTX ctx;</span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">MD5_Init(&amp;ctx);</span><br><span class="line"><span class="comment">// 添加数据</span></span><br><span class="line">MD5_Update(&amp;ctx, str, <span class="built_in">strlen</span>(str));</span><br><span class="line"><span class="comment">// 计算结果</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> md[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">MD5_Final(md, &amp;ctx);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">sprintf</span>(&amp;result[i * <span class="number">2</span>], <span class="string">"%02x"</span>, md[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> result[<span class="number">33</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">getMD5(<span class="string">"hello, md5"</span>, result);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"md5 value: %s\n"</span>, result);</span><br><span class="line">system(<span class="string">"pause"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输出结果: </span><br><span class="line">md5 value: <span class="number">33b</span>3bc8e05b4fcc16bd531dd9adac166</span><br></pre></td></tr></table></figure><h3 id="32-linux下的使用和测试"><a class="markdownIt-Anchor" href="#32-linux下的使用和测试"></a> 3.2 Linux下的使用和测试</h3><ol><li><p>编程应用程序,  测试代码如上, 文件名为  <code>md5_test.c</code></p></li><li><p>通过gcc编译源文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc md5_test.c -o md5 -lssl -lcrypto</span><br><span class="line">执行该命令, 需要加载openssl的两个动态库</span><br><span class="line">- libssl.so</span><br><span class="line">- libcrypto.so</span><br></pre></td></tr></table></figure></li><li><p>查看生成的可执行程序 md5 运行时需要加载的动态库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd md5</span><br></pre></td></tr></table></figure><p>输出结果:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">linux-vdso.so.1 =&gt;  (0x00007ffdac781000)</span><br><span class="line">libssl.so.1.1 =&gt; not found</span><br><span class="line">libcrypto.so.1.1 =&gt; not found</span><br><span class="line">libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f365c3aa000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f365c782000)</span><br></pre></td></tr></table></figure><p>提示动态库 <mark>libssl.so.1.1</mark> 和 <mark>libcrypto.so.1.1</mark> 链接不到</p></li><li><p>通过find查找两个动态库的位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">find / -name "libssl.so.1.1"</span><br><span class="line">输出结果:</span><br><span class="line">/root/openssl-master/libssl.so.1.1</span><br><span class="line">/usr/local/lib64/libssl.so.1.1</span><br><span class="line"></span><br><span class="line">find / -name "libcrypto.so.1.1"</span><br><span class="line">输出结果:</span><br><span class="line">/root/openssl-master/libcrypto.so.1.1</span><br><span class="line">/usr/local/lib64/libcrypto.so.1.1</span><br></pre></td></tr></table></figure><p><strong>通过对输出结果的分析, 得出结论动态库所在的目录为:  <mark>/usr/local/lib64</mark></strong></p></li><li><p>解决问题, 将找到的<strong>动态库绝对路径</strong>添加到 <mark><strong>/etc/ld.so.conf</strong></mark> 文件中, 并<strong>使用管理员权限执行命令<mark>ldconfig</mark></strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ld.so.conf</span><br><span class="line">将/usr/local/lib64 添加到文件末尾, 保存退出配置文件</span><br><span class="line">更新配置:</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></li><li><p>验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ldd md5</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffcd8fe0000)</span><br><span class="line">        libssl.so.1.1 =&gt; /usr/local/lib64/libssl.so.1.1 (0x00007fb7aae7d000)</span><br><span class="line">        libcrypto.so.1.1 =&gt; /usr/local/lib64/libcrypto.so.1.1 (0x00007fb7aa9a2000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fb7aa5e1000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fb7aa3dd000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fb7aa1c0000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fb7ab123000)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-安装&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-安装&quot;&gt;&lt;/a&gt; 1. 安装&lt;/h2&gt;
&lt;h3 id=&quot;11-windows下安装openssl&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#11
      
    
    </summary>
    
      <category term="OpenSSL" scheme="https://xiaowuyoucy.github.io/categories/OpenSSL/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQL中的事务</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/16/MySQL%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/16/MySQL中的事务/</id>
    <published>2022-05-16T01:23:35.000Z</published>
    <updated>2022-05-16T01:24:54.209Z</updated>
    
    <content type="html"><![CDATA[<p>修改mysql为手工提交:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 开启事务</span><br><span class="line">start transaction;</span><br><span class="line">2 设置手工提交</span><br><span class="line">set autocommit=0;</span><br><span class="line"></span><br><span class="line">1 开启事务</span><br><span class="line">start transaction;</span><br><span class="line">2 设置自动提交</span><br><span class="line">set autocommit=1;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mysql中的事务</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mysql.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SET_TRAN<span class="meta-string">"SET AUTOCOMMIT=0"</span>  <span class="comment">//手动commit————手动commit</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNSET_TRAN<span class="meta-string">"SET AUTOCOMMIT=1"</span><span class="comment">//自动commit</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _HOST_ <span class="meta-string">"127.0.0.1"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _USER_ <span class="meta-string">"root"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _PASSWD_ <span class="meta-string">"123456"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _DBNAME_ <span class="meta-string">"scott"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置事务为手动提交</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_OperationTran</span><span class="params">(MYSQL *mysql)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//--开启事务</span></span><br><span class="line"><span class="keyword">int</span> ret = mysql_query(mysql, <span class="string">"start transaction"</span>);  </span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_OperationTran query start err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--设置事务为手动提交</span></span><br><span class="line">ret = mysql_query(mysql, SET_TRAN);<span class="comment">//set　autocommmit = 0</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_OperationTran query set err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置事务为自动提交</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_AutoTran</span><span class="params">(MYSQL *mysql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//--开启事务</span></span><br><span class="line"><span class="keyword">int</span> ret = mysql_query(mysql, <span class="string">"start transaction"</span>);  </span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_AutoTran query start err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//--设置事务为自动提交</span></span><br><span class="line">ret = mysql_query(mysql, UNSET_TRAN);  <span class="comment">//"set autocommit = 1"</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_AutoTran query set err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行commit，手动提交事务</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_Commit</span><span class="params">(MYSQL *mysql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ret = mysql_query(mysql, <span class="string">"COMMIT"</span>); <span class="comment">//提交</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"commit err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行rollback，回滚事务</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_Rollback</span><span class="params">(MYSQL *mysql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ret = mysql_query(mysql, <span class="string">"ROLLBACK"</span>);</span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"rollback err: %s\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DROP_SAMPLE_TABLE <span class="meta-string">"DROP TABLE IF EXISTS test_table"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CREATE_SAMPLE_TABLE <span class="meta-string">"CREATE TABLE test_table(col1 INT,\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">                                                 col2 VARCHAR(10),\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">                                                 col3 VARCHAR(10))"</span></span></span><br><span class="line">                                                                                       </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sql01 <span class="meta-string">"INSERT INTO test_table(col1,col2,col3) VALUES(10, 'AAA', 'A1')"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sql02 <span class="meta-string">"INSERT INTO test_table(col1,col2,col3) VALUES(20, 'BBB', 'B2')"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sql03 <span class="meta-string">"INSERT INTO test_table(col1,col2,col3) VALUES(30, 'CCC', 'C3')"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sql04 <span class="meta-string">"INSERT INTO test_table(col1,col2,col3) VALUES(40, 'DDD', 'D4')"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">MYSQL *mysql = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">mysql = mysql_real_connect(mysql, _HOST_, _USER_, _PASSWD_, _DBNAME_, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (mysql == <span class="literal">NULL</span>) &#123;</span><br><span class="line">ret = mysql_errno(mysql);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"func mysql_real_connect() err：%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" --- connect ok......\n"</span>);</span><br><span class="line"><span class="comment">//执行删除表</span></span><br><span class="line"><span class="keyword">if</span> (mysql_query(mysql, DROP_SAMPLE_TABLE)) &#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" DROP TABLE failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_error(mysql));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行创建表</span></span><br><span class="line"><span class="keyword">if</span> (mysql_query(mysql, CREATE_SAMPLE_TABLE)) &#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" CREATE TABLE failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_error(mysql));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_OperationTran(mysql); <span class="comment">//开启事务，并修改事务属性为手动commit </span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_OperationTran() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_query(mysql, sql01);<span class="comment">//向表中插入第一行数据 ‘AAA’</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_query(mysql, sql02);<span class="comment">//向表中插入第二行数据 ‘BBB’</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_Commit(mysql); <span class="comment">//手动提交事务</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_Commit() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////////AAA BBB  进去了。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 1 </span></span><br><span class="line">ret = mysql_AutoTran(mysql); <span class="comment">// =再次= 修改事务属性为【自动】commit</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_OperationTran() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line">ret = mysql_OperationTran(mysql); <span class="comment">// =再次= 修改事务属性为【手动】commit</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_OperationTran() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">ret = mysql_query(mysql, sql03);<span class="comment">//向表中插入第三行数据 ‘CCC’</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_query(mysql, sql04);<span class="comment">//向表中插入第四行数据 ‘DDD’</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = mysql_Rollback(mysql);<span class="comment">//直接rollback操作</span></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_Rollback() err:%d\n"</span>, ret);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//rollback操作是否能回退掉CCC、DDD的值，取决于事务属性。</span></span><br><span class="line"></span><br><span class="line">mysql_close(mysql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;修改mysql为手工提交:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>预处理类API函数</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/16/%E9%A2%84%E5%A4%84%E7%90%86%E7%B1%BBAPI%E5%87%BD%E6%95%B0/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/16/预处理类API函数/</id>
    <published>2022-05-16T01:22:35.000Z</published>
    <updated>2022-05-16T01:32:30.704Z</updated>
    
    <content type="html"><![CDATA[<p>该类函数解决问题：处理带有占位符的SQL语句。insert into table111(col1, col2, col3) values(?, ?, ?);</p><p>这种SQL语句由两部分组成，一部分是SQL语句体模型部分，另一部分是？所匹配的值。</p><p>性能、调优是数据库编程永恒不变的主题！如果能把SQL语句框架预先处理好，当真正要执行SQL语句时只需要发送对应的参数到对应的SQL框架中，就能提高客户端访问服务器的速度，且数据量小，可以减少网络通信量，提高数据传输效率高。</p><p>元数据（Metadata）：又称中介数据、中继数据，为描述数据的数据，主要是描述数据属性的信息，用来支持如指示存储位置、历史数据、资源查找、文件记录等功能。</p><p>根据API提供的案例学习该部分内容。主要有 4 个函数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql_stmt_init()初始化预处理环境句柄。返回一个结构体指针 MYSQL_STMT *stmt</span><br><span class="line"></span><br><span class="line">mysql_stmt_prepare()向上面句柄中添加SQL语句，带有 (?,?,?) 占位符</span><br><span class="line"></span><br><span class="line">mysql_stmt_param_count() 求绑定变量的个数(辅助函数)， 有多少个&apos;?&apos;就返回多少</span><br><span class="line"></span><br><span class="line">mysql_stmt_bind_param()将?对应的实参，设置到预处理环境句柄中</span><br><span class="line"></span><br><span class="line">mysql_stmt_execute()执行预处理的SQL语句</span><br></pre></td></tr></table></figure><p><img src="/images/javawz/image-20220516093213505.png" alt="image-20220516093213505"></p><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mysql.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _HOST_ <span class="meta-string">"localhost"</span>  <span class="comment">//主机</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _USER_ <span class="meta-string">"root"</span>       <span class="comment">//mysql用户,非主机</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _PASSWD_ <span class="meta-string">"123456"</span>   <span class="comment">//密码</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _DBNAME_ <span class="meta-string">"scott"</span>    <span class="comment">//库名</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STRING_SIZE 50</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DROP_SAMPLE_TABLE <span class="meta-string">"DROP TABLE IF EXISTS test_table"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CREATE_SAMPLE_TABLE <span class="meta-string">"CREATE TABLE test_table(col1 INT,\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">                                                 col2 VARCHAR(40),\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">                                                 col3 SMALLINT,\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">                                                 col4 TIMESTAMP)"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INSERT_SAMPLE <span class="meta-string">"INSERT INTO test_table(col1,col2,col3) VALUES(?,?,?)"</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prepare_insert</span><span class="params">(MYSQL *mysql)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//1.初始化</span></span><br><span class="line">MYSQL * mysql = <span class="literal">NULL</span>;</span><br><span class="line">mysql = mysql_init(<span class="literal">NULL</span>) ;</span><br><span class="line"><span class="keyword">if</span>(mysql == <span class="literal">NULL</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql init err\n"</span>);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.连接</span></span><br><span class="line">mysql = mysql_real_connect(mysql, _HOST_,_USER_, _PASSWD_,_DBNAME_, <span class="number">0</span>, <span class="literal">NULL</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(mysql == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_real_connect connect err\n"</span>);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"welcome to mysql \n"</span>);</span><br><span class="line">prepare_insert(mysql);</span><br><span class="line"><span class="comment">//3.关闭</span></span><br><span class="line">    mysql_close(mysql);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prepare_insert</span><span class="params">(MYSQL *mysql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">MYSQL_STMT    *stmt;<span class="comment">//预处理的句柄</span></span><br><span class="line">MYSQL_BIND    bind[<span class="number">3</span>];<span class="comment">//绑定变量 </span></span><br><span class="line">my_ulonglong  affected_rows;</span><br><span class="line"><span class="keyword">int</span>           param_count;</span><br><span class="line"><span class="keyword">short</span>         small_data;</span><br><span class="line"><span class="keyword">int</span>           int_data;</span><br><span class="line"><span class="keyword">char</span>          str_data[STRING_SIZE];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> str_length;</span><br><span class="line">my_bool       is_null;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (mysql_query(mysql, DROP_SAMPLE_TABLE))<span class="comment">//删除表</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" DROP TABLE failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_error(mysql));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (mysql_query(mysql, CREATE_SAMPLE_TABLE))<span class="comment">//创建表</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" CREATE TABLE failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_error(mysql));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Prepare an INSERT query with 3 parameters */</span></span><br><span class="line"><span class="comment">/* (the TIMESTAMP column is not named; the server */</span></span><br><span class="line"><span class="comment">/*  sets it to the current date and time) */</span></span><br><span class="line">stmt = mysql_stmt_init(mysql); <span class="comment">//预处理的初始化</span></span><br><span class="line"><span class="keyword">if</span> (!stmt)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" mysql_stmt_init(), out of memory\n"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mysql_stmt_prepare(stmt, INSERT_SAMPLE, <span class="built_in">strlen</span>(INSERT_SAMPLE))) <span class="comment">//insert 语句 的预处理 </span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" mysql_stmt_prepare(), INSERT failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_stmt_error(stmt));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">" prepare, INSERT successful\n"</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Get the parameter count from the statement */</span></span><br><span class="line">param_count= mysql_stmt_param_count(stmt);<span class="comment">//获得参数个数 </span></span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">" total parameters in INSERT: %d\n"</span>, param_count);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (param_count != <span class="number">3</span>) <span class="comment">/* validate parameter count */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" invalid parameter count returned by MySQL\n"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Bind the data for all 3 parameters */</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">memset</span>(bind, <span class="number">0</span>, <span class="keyword">sizeof</span>(bind));</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* INTEGER PARAM */</span></span><br><span class="line"><span class="comment">/* This is a number type, so there is no need to specify buffer_length */</span></span><br><span class="line">bind[<span class="number">0</span>].buffer_type= MYSQL_TYPE_LONG;</span><br><span class="line">bind[<span class="number">0</span>].buffer= (<span class="keyword">char</span> *)&amp;int_data;<span class="comment">//内存地址的映射 </span></span><br><span class="line">bind[<span class="number">0</span>].is_null= <span class="number">0</span>;</span><br><span class="line">bind[<span class="number">0</span>].length= <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* STRING PARAM */</span></span><br><span class="line">bind[<span class="number">1</span>].buffer_type= MYSQL_TYPE_STRING;</span><br><span class="line">bind[<span class="number">1</span>].buffer= (<span class="keyword">char</span> *)str_data;<span class="comment">//char 100 </span></span><br><span class="line">bind[<span class="number">1</span>].buffer_length= STRING_SIZE;</span><br><span class="line">bind[<span class="number">1</span>].is_null= <span class="number">0</span>;</span><br><span class="line">bind[<span class="number">1</span>].length= &amp;str_length;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* SMALLINT PARAM */</span></span><br><span class="line">bind[<span class="number">2</span>].buffer_type= MYSQL_TYPE_SHORT;</span><br><span class="line">bind[<span class="number">2</span>].buffer= (<span class="keyword">char</span> *)&amp;small_data;</span><br><span class="line">bind[<span class="number">2</span>].is_null= &amp;is_null;<span class="comment">//是否为null的指示器 </span></span><br><span class="line">bind[<span class="number">2</span>].length= <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Bind the buffers */</span></span><br><span class="line"><span class="keyword">if</span> (mysql_stmt_bind_param(stmt, bind)) <span class="comment">//绑定变量 参数绑定</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" mysql_stmt_bind_param() failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_stmt_error(stmt));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第一波赋值 </span></span><br><span class="line">int_data= <span class="number">10</span>;             <span class="comment">/* integer */</span></span><br><span class="line"><span class="built_in">strncpy</span>(str_data, <span class="string">"MySQL"</span>, STRING_SIZE); <span class="comment">/* string  */</span></span><br><span class="line">str_length= <span class="built_in">strlen</span>(str_data);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* INSERT SMALLINT data as NULL */</span></span><br><span class="line">is_null= <span class="number">1</span>;<span class="comment">//指示插入的第三个字段是否为null </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Execute the INSERT statement - 1*/</span></span><br><span class="line"><span class="keyword">if</span> (mysql_stmt_execute(stmt)) <span class="comment">//预处理的执行,第一次执行 </span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" mysql_stmt_execute(), 1 failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_stmt_error(stmt));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Get the total number of affected rows */</span></span><br><span class="line">affected_rows= mysql_stmt_affected_rows(stmt);<span class="comment">//预处理的影响条数</span></span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">" total affected rows(insert 1): %lu\n"</span>,</span><br><span class="line">                (<span class="keyword">unsigned</span> <span class="keyword">long</span>) affected_rows);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (affected_rows != <span class="number">1</span>) <span class="comment">/* validate affected rows */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" invalid affected rows by MySQL\n"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第二波赋值 </span></span><br><span class="line">int_data= <span class="number">1000</span>;</span><br><span class="line"><span class="built_in">strncpy</span>(str_data, <span class="string">"The most popular Open Source database"</span>, STRING_SIZE);</span><br><span class="line">str_length= <span class="built_in">strlen</span>(str_data);</span><br><span class="line">small_data= <span class="number">1000</span>;         <span class="comment">/* smallint */</span></span><br><span class="line">is_null= <span class="number">0</span>;               <span class="comment">/* reset */</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Execute the INSERT statement - 2*/</span></span><br><span class="line"><span class="keyword">if</span> (mysql_stmt_execute(stmt))<span class="comment">//第二次执行</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" mysql_stmt_execute, 2 failed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_stmt_error(stmt));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Get the total rows affected */</span></span><br><span class="line">affected_rows= mysql_stmt_affected_rows(stmt);</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">" total affected rows(insert 2): %lu\n"</span>,</span><br><span class="line">                (<span class="keyword">unsigned</span> <span class="keyword">long</span>) affected_rows);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (affected_rows != <span class="number">1</span>) <span class="comment">/* validate affected rows */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" invalid affected rows by MySQL\n"</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* Close the statement */</span></span><br><span class="line"><span class="keyword">if</span> (mysql_stmt_close(stmt))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" failed while closing the statement\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">" %s\n"</span>, mysql_stmt_error(stmt));</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;该类函数解决问题：处理带有占位符的SQL语句。insert into table111(col1, col2, col3) values(?, ?, ?);&lt;/p&gt;
&lt;p&gt;这种SQL语句由两部分组成，一部分是SQL语句体模型部分，另一部分是？所匹配的值。&lt;/p&gt;
&lt;p&gt;性能
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>mysql客户端开发</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/16/mysql%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/16/mysql客户端开发/</id>
    <published>2022-05-15T23:55:50.000Z</published>
    <updated>2022-05-16T00:12:50.754Z</updated>
    
    <content type="html"><![CDATA[<h3 id="思路分析"><a class="markdownIt-Anchor" href="#思路分析"></a> 思路分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysql客户端编写思路分析:</span><br><span class="line">1 mysql初始化--mysql_init</span><br><span class="line">2 连接mysql数据库---mysql_real_connect</span><br><span class="line">3 while(1)</span><br><span class="line">  &#123;</span><br><span class="line">  //打印提示符:write(STDOUT_FILENO, &quot;mysql &gt;&quot;, strlen(&quot;mysql &gt;&quot;));</span><br><span class="line">  //读取用户输入: read(STDIN_FILENO, buf, sizeof(buf))</span><br><span class="line">  //判断用户输入的是否为退出: QUIT quit exit EXIT</span><br><span class="line">  if(strncasecmp(buf, &quot;exit&quot;, 4)==0 || strncasecmp(buf, &quot;quit&quot;, 4)==0)</span><br><span class="line">  &#123;</span><br><span class="line">  //关闭连接---mysql_close();</span><br><span class="line">  exit();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  //执行sql语句--mysql_query();</span><br><span class="line">  </span><br><span class="line">  //若不是select查询, 打印执行sql语句影响的行数--mysql_affected_rows();</span><br><span class="line">  if(strncasecmp(buf, &quot;select&quot;, 6)!=0)</span><br><span class="line">  &#123;</span><br><span class="line">  printf(&quot;Query OK, %d row affected&quot;, mysql_affected_rows());</span><br><span class="line">  continue;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  //若是select查询的情况</span><br><span class="line">  ---//获取列数: mysql_field_count()</span><br><span class="line">  //获取结果集: mysql_store_result()</span><br><span class="line">  --获取列数: int mysql_num_fields();</span><br><span class="line">  //获取表头信息并打印表头信息:mysql_fetch_fields();</span><br><span class="line">  </span><br><span class="line">  //循环获取每一行记录并打印: mysql_fetch_row()</span><br><span class="line">  //释放结果集: mysql_free_result()</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">4 关闭连接: mysql_close();</span><br></pre></td></tr></table></figure><ol><li>仿照mysql工具，应在连接数据库成功之后，在一个while循环中不断的接受用户输入的SQL语句。定义char sqlbuf[1024] 存储用户输入的SQL语句。初始化该buf，并提示用户输入SQL语句。使用gets函数在循环中动态接收用户输入。</li></ol><p>​</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while (1) &#123;</span><br><span class="line"></span><br><span class="line">memset(sqlbuf, 0, sizeof(sqlbuf));</span><br><span class="line"></span><br><span class="line">printf(&quot;\nYourSQL&gt; &quot;);</span><br><span class="line"></span><br><span class="line">fgets(sqlbuf, sizeof(sqlbuf), stdin);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>在mysql_query(connect, sqlbuf)之前，如果用户输入了“exit”那么程序直接结束。</p></li><li><p>在执行完 mysql_query(connect, sqlbuf)之后，应该判别用户输入的是否为select语句。如不是select语句不需要查询结果集、处理结果集等繁复操作。</p></li><li><p>如用户输入的是有结果集的SQL语句，将获取列数、获取结果集、获取表头、解析结果集、释放结果集等相关代码一起并入if (strncmp(sqlbuf, “select”, 6))中。</p></li></ol><p>​测试注意：执行SQL语句时不要在结尾加“;”</p><h3 id="中文问题"><a class="markdownIt-Anchor" href="#中文问题"></a> 中文问题：</h3><p>​修改<code>mysql_real_connect()</code>参数，连接到表中有中文数据的数据库，如mydb2，执行程序，测试显示中文出现乱码。我们可以使用mysql_query函数来解决该问题。</p><p>​在 while (1) 之前使用<code>ret = mysql_query(mysql, &quot;set names utf8&quot;);</code>来设置查询属性(也可以加到while中)。表示在查询的时候使用utf8的形式进行查询。</p><p>或者<code>mysql_set_character_set(mysql, &quot;utf8&quot;);</code></p><p>获取当前使用的字符集:  <code>const char *mysql_character_set_name(MYSQL *mysql)</code></p><h3 id="程序实现"><a class="markdownIt-Anchor" href="#程序实现"></a> 程序实现</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟mysql客户端程序</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mysql.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//mysql初始化---mysql_init</span></span><br><span class="line">MYSQL *mysql = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(mysql==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_init error\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line">MYSQL *conn = mysql_real_connect(mysql, <span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>, <span class="string">"scott"</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(conn==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"connect mysql db error, [%s]\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取当前进程使用的字符集</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"before:[%s]\n"</span>, mysql_character_set_name(conn));</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字符集为utf8格式</span></span><br><span class="line">mysql_set_character_set(conn, <span class="string">"utf8"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"after:[%s]\n"</span>, mysql_character_set_name(conn));</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> ret;</span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">char</span> *p;</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">MYSQL_RES *results;</span><br><span class="line">MYSQL_FIELD *fields;</span><br><span class="line">MYSQL_ROW row;</span><br><span class="line"></span><br><span class="line"><span class="comment">//进入循环等待用户输入sql语句并执行sql语句</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//打印提示符</span></span><br><span class="line">write(STDOUT_FILENO, <span class="string">"mysql&gt; "</span>, <span class="built_in">strlen</span>(<span class="string">"mysql&gt; "</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取用户输入</span></span><br><span class="line"><span class="built_in">memset</span>(buf, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">read(STDIN_FILENO, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line"><span class="comment">//1-去掉末尾的;</span></span><br><span class="line">p = <span class="built_in">strrchr</span>(buf, <span class="string">';'</span>);</span><br><span class="line"><span class="keyword">if</span>(p!=<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">*p = <span class="string">'\0'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2-去掉回车</span></span><br><span class="line"><span class="keyword">if</span>(buf[<span class="number">0</span>]==<span class="string">'\n'</span>) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//去掉最前面的几个空格</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="built_in">strlen</span>(buf); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(buf[i]!=<span class="string">' '</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">n = <span class="built_in">strlen</span>(buf);</span><br><span class="line">memmove(buf, buf+i, n-i+<span class="number">1</span>); <span class="comment">//+1表示多拷贝一个\0</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[%s]\n"</span>, buf);</span><br><span class="line"></span><br><span class="line"><span class="comment">//若输入的是退出: exit EXIT quit QUIT</span></span><br><span class="line"><span class="keyword">if</span>(strncasecmp(buf, <span class="string">"exit"</span>, <span class="number">4</span>)==<span class="number">0</span> || strncasecmp(buf, <span class="string">"quit"</span>, <span class="number">4</span>)==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">mysql_close(conn);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行sql语句</span></span><br><span class="line">ret = mysql_query(conn, buf);</span><br><span class="line"><span class="keyword">if</span>(ret!=<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\n"</span>, mysql_error(conn));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//若用户输入的不是select查询</span></span><br><span class="line"><span class="keyword">if</span>(strncasecmp(buf, <span class="string">"select"</span>, <span class="number">6</span>)!=<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Query OK, %ld row affected\n"</span>, mysql_affected_rows(conn));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面是select查询的情况</span></span><br><span class="line"><span class="comment">//获取结果集</span></span><br><span class="line">results = mysql_store_result(conn);</span><br><span class="line"><span class="keyword">if</span>(results==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\n"</span>, mysql_error(conn));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取列数</span></span><br><span class="line">num = mysql_num_fields(results);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取表头---列名</span></span><br><span class="line">fields = mysql_fetch_fields(results);</span><br><span class="line"><span class="keyword">if</span>(fields==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\n"</span>, mysql_error(conn));</span><br><span class="line">mysql_free_result(results);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印表头</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+----------+-----------+\n"</span>);</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;num; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\t"</span>, fields[i].name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+----------+-----------+\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环获取每一行记录</span></span><br><span class="line"><span class="keyword">while</span>(row=mysql_fetch_row(results))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;num; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\t"</span>, row[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+----------+-----------+\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//释放结果集</span></span><br><span class="line">mysql_free_result(results);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭数据库连接</span></span><br><span class="line">mysql_close(conn);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;思路分析&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#思路分析&quot;&gt;&lt;/a&gt; 思路分析&lt;/h3&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;s
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>linux下环境变量配置</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/16/linux%E4%B8%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/16/linux下环境变量配置/</id>
    <published>2022-05-15T17:08:36.000Z</published>
    <updated>2022-05-15T17:48:00.527Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境变量"><a class="markdownIt-Anchor" href="#环境变量"></a> 环境变量</h3><ol><li><p><a href>环境变量的分类</a></p></li><li><p><a href>查看环境变量</a></p></li><li><p><a href>常用命名</a></p><ol><li><a href>PATH</a></li><li><a href>LANG</a></li><li><a href>HOSTNAME</a></li><li><a href>SHELL</a></li><li><a href>HISTSIZE</a></li><li><a href>USER</a></li><li><a href>HOME</a></li><li><a href>PWD</a></li><li><a href>CLASSPATH</a></li></ol></li><li><p><a href>设置环境变量</a></p><ol><li><p><a href>系统环境变量</a></p><ol><li><a href>在/etc/profile文件中设置</a></li><li><a href>在/etc/profile文件目录中增加环境变量脚本文件,这是linux推荐的方法</a></li><li><a href>在/etc/bashrc文件中设置环境变量</a></li></ol></li><li><p><a href>用户环境变量</a></p><ol><li><a href> .bash_profile(推荐首选)</a></li><li><a href> .bashrc</a></li><li><a href> .bash_logout</a></li><li><a href>.bash_history</a></li></ol></li></ol></li><li><p><a href>重要的环境变量</a></p><ol><li><a href>PATH环境 变量</a></li><li><a href>LANG环境变量</a></li><li><a href>CLASSPATH</a></li></ol></li></ol><p>linux环境变量也成为Shell环境变量，习惯大写。<br><br><br></p><h2 id="1环境变量的分类"><a class="markdownIt-Anchor" href="#1环境变量的分类"></a> 1.环境变量的分类</h2><ul><li>按生效的范围分类<ul><li>系统环境变量<ul><li>公共的，对全部的用户都生效</li></ul></li><li>用户环境变量<ul><li>用户私有的、自定义的个性化设置、只针对该用户有效</li></ul></li></ul></li><li>按生存周期分类<ul><li>永久环境变量<ul><li>在环境变量脚本文件中配置，用户每次登录时会自动执行这些脚本，相当于永久有效</li></ul></li><li>临时环境变量<ul><li>使用时在Shell中临时定义，退出Shell后失效。</li></ul></li></ul></li></ul><p><br><br></p><h2 id="2查看环境变量"><a class="markdownIt-Anchor" href="#2查看环境变量"></a> 2.查看环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">env //查看所有环境变量</span><br><span class="line"></span><br><span class="line">env | grep lan //用lan过滤环境变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo $PATH  //查看变量值</span><br></pre></td></tr></table></figure><p><br><br></p><h2 id="3常用命名"><a class="markdownIt-Anchor" href="#3常用命名"></a> 3.常用命名</h2><h4 id="1path"><a class="markdownIt-Anchor" href="#1path"></a> 1.PATH</h4><p>path为可执行环境的搜索目录，可执行程序包括Linux系统命令和用户的应用程序</p><h4 id="2lang"><a class="markdownIt-Anchor" href="#2lang"></a> 2.LANG</h4><h4 id="3hostname"><a class="markdownIt-Anchor" href="#3hostname"></a> 3.HOSTNAME</h4><p>服务器的主机名</p><h4 id="4shell"><a class="markdownIt-Anchor" href="#4shell"></a> 4.SHELL</h4><p>用户当前使用的Shell解析器</p><h4 id="5histsize"><a class="markdownIt-Anchor" href="#5histsize"></a> 5.HISTSIZE</h4><p>保存历史命令的条数</p><h4 id="6user"><a class="markdownIt-Anchor" href="#6user"></a> 6.USER</h4><p>当前登录用户的名字</p><h4 id="7home"><a class="markdownIt-Anchor" href="#7home"></a> 7.HOME</h4><p>当前登录用户的主目录</p><h4 id="8pwd"><a class="markdownIt-Anchor" href="#8pwd"></a> 8.PWD</h4><p>当前工作目录</p><h4 id="9classpath"><a class="markdownIt-Anchor" href="#9classpath"></a> 9.CLASSPATH</h4><p>java语言库文件搜索的目录，它不是Linux缺省的环境变量，但对java程序员来说非常重要。<br><br></p><h2 id="4设置环境变量"><a class="markdownIt-Anchor" href="#4设置环境变量"></a> 4.设置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">变量名=&apos;值&apos;</span><br><span class="line">export变量名</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">export 变量名=&apos;值&apos;</span><br><span class="line"></span><br><span class="line">如果环境变量的值中没有空格等特殊的字符，单引号可以不写</span><br></pre></td></tr></table></figure><p><strong>采用export配置的环境变量在退出Shell后环境变量将会失效。</strong></p><h4 id="系统环境变量"><a class="markdownIt-Anchor" href="#系统环境变量"></a> 系统环境变量</h4><p>系统环境变量对全部要用户都生效，设置系统环境有三种方法。需要root用户权限</p><br><br><h4 id="1在etcprofile文件中设置"><a class="markdownIt-Anchor" href="#1在etcprofile文件中设置"></a> 1.在/etc/profile文件中设置</h4><p>用户登录时执行/etc/profile文件中设置系统的环境变量。但是不推荐使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">export VAR=&apos;hello&apos;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用 env  $VAR查看环境变量的值</span><br></pre></td></tr></table></figure><p><br><br></p><h4 id="2在etcprofile文件目录中增加环境变量脚本文件这是linux推荐的方法"><a class="markdownIt-Anchor" href="#2在etcprofile文件目录中增加环境变量脚本文件这是linux推荐的方法"></a> 2.在/etc/profile文件目录中增加环境变量脚本文件,这是linux推荐的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/profile.d</span><br><span class="line"></span><br><span class="line">vi var.sh  //新建打开脚本文件var.sh</span><br><span class="line">export VAR=&apos;hello&apos;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">退出重新登录后，环境变量生效</span><br><span class="line">env $VAR</span><br></pre></td></tr></table></figure><br><br><h4 id="3在etcbashrc文件中设置环境变量"><a class="markdownIt-Anchor" href="#3在etcbashrc文件中设置环境变量"></a> 3.在/etc/bashrc文件中设置环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">该文件配置的环境变量将会影响全部用户使用的bash shell 。但是不建议使用</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/bashrc</span><br><span class="line"></span><br><span class="line">export VAR=&apos;hello&apos;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">退出重新登录后，环境变量使用</span><br><span class="line">env $VAR</span><br></pre></td></tr></table></figure><br><br><h3 id="2用户环境变量"><a class="markdownIt-Anchor" href="#2用户环境变量"></a> 2.用户环境变量</h3><p>在用户的主目录中，有几个特别的文件，用ls是看不见的，用<code>ls .bash_*</code>可以看见。设置用户环境变量有多种方法</p><ol><li><strong>.bash_profile(推荐首选)</strong></li></ol><p>当用户登录时执行，每个用户都可以使用该文件来配置专属自己的环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bash_profile//使环境变量生效</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>.bashrc</strong></li></ol><p>当用户登录时以及每次打开新的Shell文件时，该文件都将会被读取，不推荐里面配置用户专用的环境变量，因为每开一个Shell，该文件都会被读取一次，效率肯定受影响。<br>3.  <strong>.bash_logout</strong></p><p>当每次退出系统（退出bash shell）时执行该文件。<br>4.  <strong>.bash_history</strong></p><p>保存当前用户使用过的历史命令</p><p>环境变量脚本文件的执行顺序</p><p><strong>/etc/profile --&gt; /etc/profile.d --&gt; /etc/bahrc --&gt; 用户的.bash_profile --&gt; 用户的.bashrc</strong></p><p>如果同名的话，后面的环境变量会覆盖前面的环境变量<br><br></p><br><h2 id="5重要的环境变量"><a class="markdownIt-Anchor" href="#5重要的环境变量"></a> 5.重要的环境变量</h2><h3 id="1path环境-变量"><a class="markdownIt-Anchor" href="#1path环境-变量"></a> 1.PATH环境 变量</h3><p><strong>1.PATH环境变量存放的是目录列表，目录之间用冒号 : 分隔，最后的原点 . 表示当前目录</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=目录1:目录2:目录3:......目录n:.</span><br></pre></td></tr></table></figure><p><strong>2.PATH缺省包含了linux系统命令所在的目录（/usr/local/bin:/usr/local/sbin:/usr/sbin），如果不包含这些目录,linux的常用命令也无法执行（要输入绝对路径才能执行）。</strong></p><p><strong>3.在用户的.bash_profile文件中，会对PATH进行扩充</strong></p><br><br><h4 id="2lang环境变量"><a class="markdownIt-Anchor" href="#2lang环境变量"></a> 2.LANG环境变量</h4><p>LANG环境变量存放的是linux系统的语言、地区、字符集，它不需要系统管理员手工设置，/etc/profile会调用/etc/profile.d/lang.sh脚本完成对LANG的设置。</p><br><br><h4 id="3classpath"><a class="markdownIt-Anchor" href="#3classpath"></a> 3.CLASSPATH</h4><p>java语言库文件搜索的目录，他不是linux缺省的环境变量，但对java程序员来说很重要。</p><p>CLASSPATH环境变量存放的也是目录列表，目录之间用冒号:分隔,最后的圆点.表示当前目录。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;环境变量&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#环境变量&quot;&gt;&lt;/a&gt; 环境变量&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href&gt;环境变量的分类&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href&gt;查看环境变量&lt;/a&gt;
      
    
    </summary>
    
      <category term="linux" scheme="https://xiaowuyoucy.github.io/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>第一个shell脚本</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/16/%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E8%84%9A%E6%9C%AC/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/16/第一个shell脚本/</id>
    <published>2022-05-15T17:00:35.000Z</published>
    <updated>2022-05-15T17:05:47.232Z</updated>
    
    <content type="html"><![CDATA[<h2 id="第一个shell脚本"><a class="markdownIt-Anchor" href="#第一个shell脚本"></a> 第一个shell脚本</h2><p>打开文本编辑器(可以使用 vi/vim 命令来创建文件)，新建一个文件 <a href="http://test.sh" target="_blank" rel="noopener">test.sh</a>，扩展名为 sh（sh代表shell），扩展名并不影响脚本执行。</p><p>第一步创建<code>***.sh</code>脚本文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ***.sh</span><br></pre></td></tr></table></figure><p>输入一些代码，第一行一般是这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;Hello World !&quot;</span><br></pre></td></tr></table></figure><p><code>#!</code>是一个约定的标记，它告诉系统这个脚本需要什么解释器来执行，即使用哪一种 Shell。</p><h3 id="运行-shell-脚本有两种方法"><a class="markdownIt-Anchor" href="#运行-shell-脚本有两种方法"></a> 运行 Shell 脚本有两种方法：</h3><p><strong>1、作为可执行程序</strong></p><p>将上面的代码保存为 <a href="http://test.sh" target="_blank" rel="noopener">test.sh</a>，并 cd 到相应目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ./test.sh  #使脚本具有执行权限</span><br><span class="line">./test.sh  #执行脚本</span><br></pre></td></tr></table></figure><p>注意，一定要写成<code>./test.sh</code>，而不是 <strong><a href="http://test.sh" target="_blank" rel="noopener">test.sh</a></strong>，运行其它二进制的程序也一样，直接写 <a href="http://test.sh" target="_blank" rel="noopener">test.sh</a>，linux 系统会去 PATH 里寻找有没有叫 <a href="http://test.sh" target="_blank" rel="noopener">test.sh</a> 的，而只有 /bin,/sbin,  /usr/bin，/usr/sbin 等在 PATH 里，你的当前目录通常不在 PATH 里，所以写成 <a href="http://test.sh" target="_blank" rel="noopener">test.sh</a> 是会找不到命令的，要用  ./test.sh 告诉系统说，就在当前目录找。</p><p><strong>2、作为解释器参数</strong></p><p>这种运行方式是，直接运行解释器，其参数就是 shell 脚本的文件名，如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh test.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;第一个shell脚本&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#第一个shell脚本&quot;&gt;&lt;/a&gt; 第一个shell脚本&lt;/h2&gt;
&lt;p&gt;打开文本编辑器(可以使用 vi/vim 命令来创建文件)，新建一个文件 &lt;a href=&quot;htt
      
    
    </summary>
    
      <category term="linux" scheme="https://xiaowuyoucy.github.io/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>MYSQL_API编程</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/MYSQL-API%E7%BC%96%E7%A8%8B/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/MYSQL-API编程/</id>
    <published>2022-05-15T15:55:00.000Z</published>
    <updated>2022-05-15T16:56:39.664Z</updated>
    
    <content type="html"><![CDATA[<p>访问MySQL服务器，这需要使用mysqlclient库，MySQL的大多数客户端API（<a href="http://xn--Java-321gi106a.NET" target="_blank" rel="noopener">除Java和.NET</a>）都是通过这个库来和MySQL服务器通讯的，而这个库正是使用C语言编写的。</p><h3 id="查看当前系统内所使用的mysql数据库版本信息"><a class="markdownIt-Anchor" href="#查看当前系统内所使用的mysql数据库版本信息"></a> 查看当前系统内所使用的mysql数据库版本信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -V</span><br></pre></td></tr></table></figure><h3 id="需要用到的库"><a class="markdownIt-Anchor" href="#需要用到的库"></a> 需要用到的库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">使用命令查找该库的路径</span><br><span class="line">find / -name libmysqlclient*</span><br><span class="line"></span><br><span class="line">命令可查看库内包含的函数。</span><br><span class="line">nm /usr/lib64/mysql/libmysqlclient.a</span><br></pre></td></tr></table></figure><h3 id="头文件"><a class="markdownIt-Anchor" href="#头文件"></a> 头文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用到头文件 &lt;mysql.h&gt; 可使用locate mysql.h查看其目录位置/usr/include/mysql/mysql.h。</span><br></pre></td></tr></table></figure><h3 id="编译引用了库的应用程序"><a class="markdownIt-Anchor" href="#编译引用了库的应用程序"></a> 编译引用了库的应用程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc 源文件名.c -o 程序名 -I/usr/include/mysql/ -L/usr/lib64/mysql/ -lmysqlclient</span><br></pre></td></tr></table></figure><h3 id="makefile"><a class="markdownIt-Anchor" href="#makefile"></a> MAKEFILE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">src = $(wildcard *.c)</span><br><span class="line">target = $(patsubst %.c, %, $(src))</span><br><span class="line">inc_path = /usr/include/mysql/</span><br><span class="line">lib_path = /usr/lib64/mysql/</span><br><span class="line">all: $(target)</span><br><span class="line">%:%.c</span><br><span class="line">gcc $&lt; -o $@ -I$(inc_path) -L$(lib_path) -lmysqlclient -lstdc++ -lpthread -ldl -lrt</span><br><span class="line">clean:</span><br><span class="line">-rm -rf $(target)</span><br><span class="line">.PHONY: all clean</span><br></pre></td></tr></table></figure><h2 id="mysql-api常用函数"><a class="markdownIt-Anchor" href="#mysql-api常用函数"></a> MySQL API常用函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">使用MySQL库API函数的一般步骤：</span><br><span class="line">a. 初始化. MYSQL *mysql_init(MYSQL *mysql)</span><br><span class="line"></span><br><span class="line">b. 错误处理unsigned int mysql_errno(MYSQL *mysql) </span><br><span class="line"></span><br><span class="line">char *mysql_error(MYSQL *mysql);</span><br><span class="line"></span><br><span class="line">c. 建立连接.</span><br><span class="line">MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd,const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag);</span><br><span class="line"></span><br><span class="line">d. 执行SQL语句int mysql_query(MYSQL *mysql, const char *stmt_str)</span><br><span class="line"></span><br><span class="line">e. 获取结果MYSQL_RES *mysql_store_result(MYSQL *mysql)</span><br><span class="line"></span><br><span class="line">MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)</span><br><span class="line"></span><br><span class="line">f. 释放内存void mysql_free_result(MYSQL_RES *result)</span><br><span class="line"></span><br><span class="line">g. 关闭连接void mysql_close(MYSQL *mysql)</span><br></pre></td></tr></table></figure><h3 id="初始化"><a class="markdownIt-Anchor" href="#初始化"></a> 初始化</h3><p>编写程序测试 初始化函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *mysql_init(MYSQL *mysql);</span><br></pre></td></tr></table></figure><p>其中有一种新数据类型MYSQL。可在头文件<code>mysql.h → 263. typedef struct st_mysql {...} MYSQL;</code>找到其定义。是一个结构体。</p><p>处理错误码的函数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unsigned int mysql_errno(MYSQL *mysql)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;mysql.h&quot;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">int i, ret = 0, num = 0;</span><br><span class="line"></span><br><span class="line">MYSQL *mysql = mysql_init(NULL);</span><br><span class="line">if (mysql == NULL) &#123;</span><br><span class="line">ret = mysql_errno(mysql);</span><br><span class="line">printf(&quot;mysql_init err:%d\n&quot;, ret);</span><br><span class="line">return ret;</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;init ok...\n&quot;);</span><br><span class="line"></span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">编译出错，原因是64位Linux环境下，动态库配置不完整。需手动指定编译所用的动态库。根据错误提示分析需要加入如下函数库：</span><br><span class="line">1.__gxx_personality_v0   --&gt; -lstdc++使用g++相关的环境</span><br><span class="line">2. dlclose/dlopen/dlsym --&gt;-ldl完成用一个程序加载其他动态库的作用。</span><br><span class="line">3. pthread_*--&gt;  -lpthread线程库</span><br><span class="line">4. `my_getsystime&apos;/`clock_gettime&apos;--&gt;  -lrtlibrt.so是glibc中对real-time的支持库</span><br><span class="line"></span><br><span class="line">使用ldd命令可以查看该可执行文件运行所依赖的库文件。</span><br></pre></td></tr></table></figure><h3 id="连接数据库关闭连接"><a class="markdownIt-Anchor" href="#连接数据库关闭连接"></a> 连接数据库关闭连接</h3><p>mysql_connect();但该函数已经过时，应该使用手册中推荐的mysql_real_connect函数取而代之。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag) ;</span><br></pre></td></tr></table></figure><p>​根据手册中的描述，我们可以使用基础的链接方式与MySQL数据库建立连接。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql = mysql_real_connect(mysql, &quot;localhost&quot;, &quot;root&quot;, &quot;123456&quot;, &quot;mydb61&quot;, 0, NULL, 0);</span><br></pre></td></tr></table></figure><p>​连接数据库成功。对表中数据进行访问，访问结束需调用void mysql_close(MYSQL *mysql) 函数关闭连接。该函数在断开连接的同时，还可以解除分配由mysql指向的连接句柄。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_close(mysql);</span><br></pre></td></tr></table></figure><h3 id="读取数据"><a class="markdownIt-Anchor" href="#读取数据"></a> 读取数据</h3><h4 id="执行sql语句"><a class="markdownIt-Anchor" href="#执行sql语句"></a> 执行SQL语句</h4><p>mysql_query函数不单单能完成查询sql的功能，还能完成非select语句在c程序中的执行。是一个十分万能的c程序中执行SQL语句的函数。并且该函数本身直接支持静态SQL。查询以\0结尾的字符串。如果语句中包含二进制数据，则需要调用mysql_real_query来执行查询语句。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">函数原型：int mysql_query(MYSQL *mysql, const char *query);成功返回0，失败返回非0</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char *psql = &quot;select * from emp&quot;;</span><br><span class="line">ret = mysql_query(mysql, psql);</span><br></pre></td></tr></table></figure><p>若执行的是UPDATE, DELETE或INSERT语句，则可通过<code>mysql_affected_rows()</code>获知受影响的记录数。</p><p>若执行的是SELECT语句，查询结束后，查询结果被保存在mysql句柄中。需要使用获取结果集的API函数将结果集获取出来。有两种方式可以获取结果集。</p><h5 id="注意-mysql_query执行的sql语句不应为语句添加终结分号或g"><a class="markdownIt-Anchor" href="#注意-mysql_query执行的sql语句不应为语句添加终结分号或g"></a> 注意: mysql_query执行的SQL语句不应为语句添加终结分号（‘;’）或“\g”。</h5><h4 id="获取结果集"><a class="markdownIt-Anchor" href="#获取结果集"></a> 获取结果集</h4><p>一种方式是通过mysql_store_result()将整个结果集全部取回来。另一种方式则是调用mysql_use_result()初始化获取操作，但暂时不取回任何记录。视结果集的条目数选择获取结果集的函数。两种方法均通过mysql_fetch_row()来访问每一条记录。</p><p>​<code>MYSQL_RES *mysql_store_result(MYSQL *mysql)</code> 成功返回<code>MYSQL_RES</code>结果集指针，失败返回NULL。</p><p>​<code>MYSQL_RES</code>是一个结构体类型，可以从mysql.h头文件中找到该结构体的定义：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql.h → 308. typedef struct st_mysql_res &#123;...&#125; MYSQL_RES;</span><br></pre></td></tr></table></figure><p>整体获取的结果集，保存在 MYSQL_RES 结构体指针中，通过检查mysql_store_result()是否返回NULL，可检测函数执行是否成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_RES *result = mysql_store_result(mysql);</span><br><span class="line">if (result == NULL) </span><br><span class="line">&#123;</span><br><span class="line">ret = mysql_errno(mysql);</span><br><span class="line">printf(&quot;mysql_store_result error: %s\n&quot;, mysql_error(mysql));</span><br><span class="line">return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该函数调用成功，则SQL查询的结果被保存在result中，但我们不清楚有多少条数据。所以应使用游标的方式将结果集中的数据逐条取出。</p><h4 id="解析结果集"><a class="markdownIt-Anchor" href="#解析结果集"></a> 解析结果集</h4><p>通过游标一行一行fetch结果集中的数据。根据游标使用的一般特性，应使用循环结构，到达结尾或者出错，返回NULL。</p><p>​函数原型：<code>MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)</code>成功返回下一行的MYSQL_ROW结构。如果没有更多要检索的行或出现了错误，返回NULL。-----MYSQL_ROW定义在118行</p><p>​<code>select * from emp</code>  可以看到emp表一共有8列数据。可以循环将每行上每一列的数据显示到屏幕。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_ROW row = NULL;//typedef char **MYSQL_ROW;</span><br><span class="line">while ((row = mysql_fetch_row(result)))</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n&quot;, row[0],row[1],row[2],row[3],row[4],row[5],row[6],row[7]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MYSQL_ROW的本质是<code>typedef char ** MYSQL_ROW;</code> 数据信息存储的形式如下图所示：</p><p><img src="../../themes/pure/source/images/javawz/image-20220516003930249.png" alt="image-20220516003930249"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从mysql.h头文件可查看MYSQL_ROW定义: 118. typedef char **MYSQL_ROW; /*return data as array of string*/</span><br></pre></td></tr></table></figure><p>从上图分析MYSQL_ROW为什么被定义为char**类型呢？推测mysq_fetch_row()的函数实现大致思想如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">char **mysql_fetch_row()&#123;</span><br><span class="line">char **tmp = (char **) malloc(sizeof(char *) * 8);</span><br><span class="line">for (i = 0; i &lt; 8; i++)</span><br><span class="line">&#123;</span><br><span class="line">tmp[i] = (char *)malloc(50);</span><br><span class="line">&#125;</span><br><span class="line">strcpy(tmp[0], &quot;7369&quot;);</span><br><span class="line">strcpy(tmp[1], &quot;SMITH&quot;);</span><br><span class="line">strcpy(tmp[2], &quot;CLERK&quot;);</span><br><span class="line">...</span><br><span class="line">return tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="释放结果集"><a class="markdownIt-Anchor" href="#释放结果集"></a> 释放结果集</h4><p>​结果集处理完成，应调用对应的函数释放所占用的内存。</p><p><code>void mysql_free_result(MYSQL_RES *result);</code>成功释放参数传递的结果集。没有失败情况。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_free_result(result);</span><br></pre></td></tr></table></figure><h4 id="获取列数"><a class="markdownIt-Anchor" href="#获取列数"></a> 获取列数</h4><p>查看帮助手册可以看到，有两个函数具备获取列数的功能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unsigned int mysql_field_count(MYSQL *mysql) 从mysql句柄中获取有多少列。</span><br><span class="line"></span><br><span class="line">unsigned int mysql_num_fields(MYSQL_RES *result) 从返回的结果集中获取有多少列。</span><br></pre></td></tr></table></figure><p>​选择任意一种方式均可以完成该功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int num = mysql_field_count(connect); </span><br><span class="line">while (row = mysql_fetch_row(result)) </span><br><span class="line">&#123;</span><br><span class="line">for (i = 0; i &lt; num; i++) &#123;</span><br><span class="line">printf(&quot;%s\t&quot;, row[i]);</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">//printf(&quot;%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n&quot;, row[0],row[1],row[2],row[3],row[4],row[5],row[6],row[7]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取表头"><a class="markdownIt-Anchor" href="#获取表头"></a> 获取表头</h4><p>获取表头的API函数同样有两个：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result) 全部获取</span><br><span class="line"></span><br><span class="line">MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result) 获取单个</span><br></pre></td></tr></table></figure><p>​MYSQL_FIELD也是一个结构体类型，其内部保存了选择列表项的信息，其中的name成员变量就保存着列名。可从头文件<code>mysql.h中94-116</code>行找到其定义。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_FIELD *fields = NULL;</span><br><span class="line">fields = mysql_fetch_fields(result);//得到表头的结构体数组</span><br><span class="line">for (i = 0; i &lt; num; i++) &#123;//已通过 mysql_field_count获取了总列数</span><br><span class="line">printf(&quot;%s\t&quot;, fields[i].name);//每一列的列名保存在name成员中 </span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;\n&quot;);</span><br></pre></td></tr></table></figure><h3 id="示例程序"><a class="markdownIt-Anchor" href="#示例程序"></a> 示例程序</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mysql获取结果集</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mysql.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//初始化</span></span><br><span class="line"><span class="comment">//MYSQL *mysql_init(MYSQL *mysql) </span></span><br><span class="line">MYSQL *mysql = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span>(mysql==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql init error\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql init ok\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接mysql数据库</span></span><br><span class="line"><span class="comment">//MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag) </span></span><br><span class="line">MYSQL *conn = mysql_real_connect(mysql, <span class="string">"192.168.10.145"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>, <span class="string">"scott"</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(conn==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_real_connect error,[%s]\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"connect mysql OK, [%p], [%p]\n"</span>, mysql, conn);</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行sql语句</span></span><br><span class="line"><span class="comment">//int mysql_query(MYSQL *mysql, const char *query) </span></span><br><span class="line"><span class="keyword">char</span> sSQL[<span class="number">255</span>] = <span class="string">"select * from mytest"</span>;</span><br><span class="line"><span class="keyword">int</span> ret = mysql_query(conn, sSQL);</span><br><span class="line"><span class="keyword">if</span>(ret!=<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query error, [%s]\n"</span>, mysql_error(mysql));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_query ok\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取列数</span></span><br><span class="line"><span class="comment">//unsigned int mysql_field_count(MYSQL *mysql) </span></span><br><span class="line"><span class="comment">//unsigned int num = mysql_field_count(conn);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取结果集</span></span><br><span class="line"><span class="comment">//MYSQL_RES *mysql_store_result(MYSQL *mysql) </span></span><br><span class="line">MYSQL_RES *results = mysql_store_result(conn);</span><br><span class="line"><span class="keyword">if</span>(results==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_store_result error,[%s]\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_store_result ok\n"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//获取列数</span></span><br><span class="line"><span class="comment">//unsigned int mysql_num_fields(MYSQL_RES *result) </span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> num = mysql_num_fields(results);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取表头信息---列名</span></span><br><span class="line"><span class="comment">//MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result)</span></span><br><span class="line">MYSQL_FIELD *fields = mysql_fetch_fields(results);</span><br><span class="line"><span class="keyword">if</span>(fields==<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"mysql_fetch_fields error,[%s]\n"</span>, mysql_error(mysql));</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印表头信息</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+------+-----------+\n"</span>);</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;num; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\t"</span>, fields[i].name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+------+-----------+\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取结果集中每一行记录</span></span><br><span class="line">MYSQL_ROW row;</span><br><span class="line"><span class="keyword">while</span>((row=mysql_fetch_row(results)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;num; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\t"</span>, row[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"+------+-----------+\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//释放结果集</span></span><br><span class="line"><span class="comment">//void mysql_free_result(MYSQL_RES *result) </span></span><br><span class="line">mysql_free_result(results);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭数据库连接</span></span><br><span class="line">mysql_close(conn);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;访问MySQL服务器，这需要使用mysqlclient库，MySQL的大多数客户端API（&lt;a href=&quot;http://xn--Java-321gi106a.NET&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;除Java和.NET&lt;/a&gt;）都是通过这个
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>npm报错，安装不上依赖，npm代理报错</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/npm%E6%8A%A5%E9%94%99%EF%BC%8C%E5%AE%89%E8%A3%85%E4%B8%8D%E4%B8%8A%E4%BE%9D%E8%B5%96%EF%BC%8Cnpm%E4%BB%A3%E7%90%86%E6%8A%A5%E9%94%99/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/npm报错，安装不上依赖，npm代理报错/</id>
    <published>2022-05-15T02:02:17.000Z</published>
    <updated>2022-05-15T02:04:35.343Z</updated>
    
    <content type="html"><![CDATA[<p>npm报错：npm ERR! code ECONNREFUSED npm ERR! errno ECONNREFUSED，npm ERR! npm ERR! If you are behind a proxy, please make sure that the</p><p>在仓库上拉下来项目，安装依赖时报错：</p><p><img src="../../themes/pure/source/images/javawz/3973b16cc5bc42c3bbfd8415f3f24ef9.png" alt="在这里插入图片描述"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">问题出现原因：Github相当于程序员的百度，但是速度有时又太慢，就使用了某VPN代理访问。结果，VPN给我开了一个端口，npm的一些依赖包访问速度巨慢，就出现了上图报错</span><br></pre></td></tr></table></figure><h3 id="解决方法"><a class="markdownIt-Anchor" href="#解决方法"></a> 解决方法</h3><h4 id="1-查看代理"><a class="markdownIt-Anchor" href="#1-查看代理"></a> 1. 查看代理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config get proxy</span><br><span class="line">npm config get https-proxy</span><br></pre></td></tr></table></figure><p>如果发现有代理，就清空它</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure><h3 id="2-全局配置淘宝镜像"><a class="markdownIt-Anchor" href="#2-全局配置淘宝镜像"></a> 2. 全局配置淘宝镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>这里再安装依赖就OK了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;npm报错：npm ERR! code ECONNREFUSED npm ERR! errno ECONNREFUSED，npm ERR! npm ERR! If you are behind a proxy, please make sure that the&lt;/p&gt;
&lt;
      
    
    </summary>
    
      <category term="hexo" scheme="https://xiaowuyoucy.github.io/categories/hexo/"/>
    
    
  </entry>
  
  <entry>
    <title>ORACLE查看数据库的库名、实例名、域名、服务器以及服务名</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/ORACLE%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%BA%93%E5%90%8D%E3%80%81%E5%AE%9E%E4%BE%8B%E5%90%8D%E3%80%81%E5%9F%9F%E5%90%8D%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A5%E5%8F%8A%E6%9C%8D%E5%8A%A1%E5%90%8D/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/ORACLE查看数据库的库名、实例名、域名、服务器以及服务名/</id>
    <published>2022-05-15T02:00:15.000Z</published>
    <updated>2022-05-15T02:00:33.216Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">一、oracle中：</span><br><span class="line">1、查询数据库名：select name,dbid from v$database;或者show parameter db_name;</span><br><span class="line">2、查询实例名：select instance_name from v$instance;或者show parameter instance_name;</span><br><span class="line">3、查询数据库域名：select value from v$parameter where name=&apos;db_domain&apos;;或者show parameter domain;</span><br><span class="line">4、查询数据库服务器：select value from v$parameter where name=&apos;service_name&apos;;或者show parameter service;或者show parameter names;</span><br><span class="line">5、数据库服务名：此参数是数据库标识类参数，用service_name表示。</span><br><span class="line">数据库如果有域，则数据库服务名就是全局数据库名；</span><br><span class="line">如果没有，则数据库服务名就是数据库名。查询：show parameter service_name;</span><br><span class="line"></span><br><span class="line">二、一般在PL/SQL下，Oracle 用户查询其他用户的表一定要使用user.table格式才能查询，每次用户名.表名嫌麻烦的话。可以使用同义词，意思将user.table访问格式改成table格式即可</span><br><span class="line">创建同义词语句格式：</span><br><span class="line">create public synonym table_name for user.table_name;</span><br><span class="line">public很关键词，访问权限修饰，若想某表的授权用户也能用同义词查询，</span><br><span class="line">必须要用public访问修饰符。</span><br><span class="line">比如：</span><br><span class="line">原本&quot;表前缀.表名&quot;格式才能访问select * from PAASDATA.paas_city_def;</span><br><span class="line">create public synonym table_name for PAASDATA.paas_city_def;</span><br><span class="line">创建同义词后直接用表名即可select * from paas_city_def;</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「我冷漠」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/weixin_43748615/article/details/117766206</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>NAT的四种类型</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/NAT%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%B1%BB%E5%9E%8B/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/NAT的四种类型/</id>
    <published>2022-05-15T01:54:16.000Z</published>
    <updated>2022-05-15T01:58:36.536Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一nat类型"><a class="markdownIt-Anchor" href="#一nat类型"></a> 一：NAT类型</h2><h3 id="基于udp的p2p应用需要考虑nat的类型因为不同的nat组合的穿透的方式并不一致有的能通-有的不能通-一般来讲-nat可以分为四种类型分别是"><a class="markdownIt-Anchor" href="#基于udp的p2p应用需要考虑nat的类型因为不同的nat组合的穿透的方式并不一致有的能通-有的不能通-一般来讲-nat可以分为四种类型分别是"></a> 基于UDP的P2P应用需要考虑NAT的类型，因为不同的NAT组合的穿透的方式并不一致，有的能通， 有的不能通。一般来讲， NAT可以分为四种类型，分别是:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1,  全锥型(Full Cone)</span><br><span class="line"></span><br><span class="line">2,  受限锥型(Restricted Cone)， 或者说是IP受限锥型</span><br><span class="line"></span><br><span class="line">3,  端口受限锥型(Port Restricted Cone), 或者说是IP + PORT受限锥型</span><br><span class="line"></span><br><span class="line">4,  对称型(Symmetric)</span><br></pre></td></tr></table></figure><p>其中<strong>1,2,3属于同一种类型，都是锥型</strong>，区别只是路由器的不同的安全策略。还有些NAT不属于这四种中的任何一种，就不在本文的讨论范围了。</p><h2 id="二为什么有四种类型的nat"><a class="markdownIt-Anchor" href="#二为什么有四种类型的nat"></a> 二：为什么有四种类型的NAT</h2><p>NAT缓解了IPV4地址不够用的问题，同时也带了限制，那就是<strong>NAT外部的主机无法主动跟位于NAT内部的主机通信，NAT内部主机想要通信，必须主动和公网的一个IP通信，路由器负责建立一个映射关系，从而实现数据的转发， 这就是NAT的工作原理</strong>。</p><h2 id="一nat使用案例"><a class="markdownIt-Anchor" href="#一nat使用案例"></a> （一）NAT使用案例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">公网server1 ip是1.1.1.1， 监听端口是1111</span><br><span class="line"></span><br><span class="line">公网server2 ip是2.2.2.2， 监听端口是2222</span><br><span class="line"></span><br><span class="line">NAT router ip是8.8.8.8</span><br><span class="line"></span><br><span class="line">NAT内部client是192.168.0.3</span><br></pre></td></tr></table></figure><p><img src="/images/javawz/1309518-20210520170839788-971942459.png" alt="img"></p><p>client发送数据的时候，不管是tcp还是udp必须本地绑定一个端口，一般来讲，这个过程都是自动的。</p><p>假定client(192.168.0.3, 100)给 server(1.1.1.1, 1111)发送报文，报文到达路由器，</p><p>路由器在自己的公网ip上开辟一个端口800，从而建立了一个隐射关系(8.8.8.8, 800)&lt;—&gt;(192.168.0.3, 100),</p><p>建立映射关系后，所以(192.168.0.3, 100)和(1.1.1.1, 1111)之间的报文都通过这个映射关系进行转发。</p><p><img src="/images/javawz/1309518-20210520171340167-1991626586.png" alt="img"></p><h2 id="二nat之间主要的区别分两种情况讨论"><a class="markdownIt-Anchor" href="#二nat之间主要的区别分两种情况讨论"></a> （二）NAT之间主要的区别分两种情况讨论</h2><h3 id="1client19216803-100和server1111-1111在路由器上建立好映射关系后如果client19216803-100又给2222-2222发送数据路由器该怎么处理呢"><a class="markdownIt-Anchor" href="#1client19216803-100和server1111-1111在路由器上建立好映射关系后如果client19216803-100又给2222-2222发送数据路由器该怎么处理呢"></a> 1:client(192.168.0.3, 100)和server(1.1.1.1, 1111)在路由器上建立好映射关系后，如果client(192.168.0.3, 100)又给(2.2.2.2, 2222)发送数据，路由器该怎么处理呢?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,  复用旧的映射关系(8.8.8.8, 800)&lt;---&gt;(192.168.0.3, 100)和(2.2.2.2, 2222)通信, 这就是锥型(Cone) NAT---（分为下面的3个小类）</span><br><span class="line"></span><br><span class="line">2,  创建新的映射关系(8.8.8.8, 801)&lt;---&gt;(192.168.0.3, 100)和(2.2.2.2, 2222)通信, 这就是对称型NAT</span><br></pre></td></tr></table></figure><p>注: (8.8.8.8, 801)只是举例，到底用什么端口取决于路由器的端口管理策略，总之是另外的一个端口，有的路由器有多个公网IP，不同的IP也会参与到这个映射关系中。</p><h3 id="2client19216803-100和server1111-1111在路由器上建立好映射关系后如果这个时候路由器8888在800端口上收到从另外一台server2222-2222发来的数据是不是应该转发给19216803-100呢"><a class="markdownIt-Anchor" href="#2client19216803-100和server1111-1111在路由器上建立好映射关系后如果这个时候路由器8888在800端口上收到从另外一台server2222-2222发来的数据是不是应该转发给19216803-100呢"></a> 2:client(192.168.0.3, 100)和server(1.1.1.1,  1111)在路由器上建立好映射关系后，如果这个时候路由器(8.8.8.8)在800端口上收到从另外一台server(2.2.2.2,  2222)发来的数据，是不是应该转发给(192.168.0.3, 100)呢？</h3><p>有四种情况:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1, 无条件转发给(192.168.0.3, 100)， 这就是全锥型(Full Cone)NAT。</span><br><span class="line"></span><br><span class="line">2, 如果(192.168.0.3, 100)之前给(2.2.2.2)发送过数据，则转发， 这就是受限锥型(Restricted Cone)。</span><br><span class="line"></span><br><span class="line">3, 如果(192.168.0.3, 100)之前给(2.2.2.2, 2222)发送过数据，则转发， 这就是端口受限锥型(Port Restricted Cone)。</span><br><span class="line"></span><br><span class="line">4, 丢弃报文，拒绝转发, 这就是对称型NAT。</span><br></pre></td></tr></table></figure><p>从上面也描述也可以看出，安全性系数, 对称型 &gt; 端口受限锥型 &gt; 受限锥型 &gt; 全锥型</p><h2 id="三不同nat的穿透性"><a class="markdownIt-Anchor" href="#三不同nat的穿透性"></a> （三）不同NAT的穿透性</h2><p><img src="/images/javawz/1309518-20210520172322286-481923861.png" alt="img"></p><p>对称nat无法穿透，这个说法不正确，<strong>对称nat与全椎full cone nat、对称nat 与 ip受限椎型cone</strong>，是可以穿透的，<strong>对称nat与 端口受限、对称nat与对称nat</strong>，不可穿透。<br>类型：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、full cone 全椎</span><br><span class="line">2、Restricted Cone ip受限</span><br><span class="line">3、port Restricted Cone 端口受限</span><br><span class="line">4、Symmetric 对称。</span><br></pre></td></tr></table></figure><h3 id="穿透关系上述4种类型如果定义他们的值为序列号n为序列号相加"><a class="markdownIt-Anchor" href="#穿透关系上述4种类型如果定义他们的值为序列号n为序列号相加"></a> 穿透关系：上述4种类型，如果定义他们的值为序列号，N为序列号相加。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">则N&lt;=6可穿透。2 和 4 序列相加 = 6 则可穿透。 </span><br><span class="line">3(端口受限)和4（对称）= 7 不可穿透。</span><br></pre></td></tr></table></figure><h1 id="三p2p网络中的nat穿透问题nat的原理和类型"><a class="markdownIt-Anchor" href="#三p2p网络中的nat穿透问题nat的原理和类型"></a> 三：p2p网络中的NAT穿透问题—NAT的原理和类型</h1><h2 id="一完全圆锥型nat-full-cane-nat"><a class="markdownIt-Anchor" href="#一完全圆锥型nat-full-cane-nat"></a> （一）完全圆锥型NAT (Full Cane NAT)</h2><h3 id="完全圆锥型的nat将从同一内部ip地址和端口来的所有请求都映射到相同的外部ip地址和端口-而且任何外部主机通过向映射的外部地址发送报文可以实现和内部主机进行通信"><a class="markdownIt-Anchor" href="#完全圆锥型的nat将从同一内部ip地址和端口来的所有请求都映射到相同的外部ip地址和端口-而且任何外部主机通过向映射的外部地址发送报文可以实现和内部主机进行通信"></a> <strong>完全圆锥型的NAT,将从同一内部IP地址和端口来的所有请求，都映射到相同的外部IP地址和端口。而且，任何外部主机通过向映射的外部地址发送报文，可以实现和内部主机进行通信。</strong></h3><p>这是一种<strong>比较宽松的策略</strong>，<strong>只要建立了内部网络的IP地址和端口与公网IP地址和端口的映射关系，则所有Internet上的主机都可以访问该NAT之后的主机！！！</strong></p><p><img src="/images/javawz/1309518-20210520174201499-1628049021.png" alt="img"></p><p>在图中，<strong>NAT会将内网地址{X:y} (x代表内网主机的IP地址，Y代表端口)映射成公网地址{A:b}(A代表映射的公网IP地址，b代表映射的端口)并绑定。任何数据分组都可以通过地址{A:b}送到此内网主机。</strong></p><h2 id="二受限圆锥型nat-restricted-cone-natip受限"><a class="markdownIt-Anchor" href="#二受限圆锥型nat-restricted-cone-natip受限"></a> （二）受限圆锥型NAT ( Restricted Cone NAT)–IP受限</h2><p>受限圆锥型NAT也是将从相同的内部IP地址和端口来的所有请求，映射到相同的公网IP地址和端口。</p><h3 id="但是与完全圆锥型nat不同当且仅当内网主机之前己经向公网主机假设ip地址为p发送过数据分组此公网主机才能够向内网主机发送数据分组"><a class="markdownIt-Anchor" href="#但是与完全圆锥型nat不同当且仅当内网主机之前己经向公网主机假设ip地址为p发送过数据分组此公网主机才能够向内网主机发送数据分组"></a> 但是与完全圆锥型NAT不同，当且仅当内网主机之前己经向公网主机(假设IP地址为P)发送过数据分组，此公网主机才能够向内网主机发送数据分组。</h3><p><img src="/images/javawz/1309518-20210520174148137-1979686418.png" alt="img"></p><p>在图中，<strong>NAT会将内网地址{x:y}映射成公网地址{A:b〕并绑定，只有源地址为P的分组才能和此内网主机通信。</strong></p><h2 id="三端口受限圆锥型nat-port-restricted-cone-natipport受限"><a class="markdownIt-Anchor" href="#三端口受限圆锥型nat-port-restricted-cone-natipport受限"></a> （三）端口受限圆锥型NAT ( Port Restricted Cone NAT)–IP+port受限</h2><h3 id="类似于受限圆锥型nat但更严格-端口受限圆锥型nat增加了端口号的限制当且仅当内网主机之前已经向公网主机发送了数据分组公网主机才能和此内网主机通信"><a class="markdownIt-Anchor" href="#类似于受限圆锥型nat但更严格-端口受限圆锥型nat增加了端口号的限制当且仅当内网主机之前已经向公网主机发送了数据分组公网主机才能和此内网主机通信"></a> 类似于受限圆锥型NAT，但更严格。<strong>端口受限圆锥型NAT增加了端口号的限制，当且仅当内网主机之前已经向公网主机发送了数据分组，公网主机才能和此内网主机通信。</strong></h3><p><img src="/images/javawz/1309518-20210520174437259-2033657389.png" alt="img"></p><p>在图中，NAT会将内网地址{X:y}映射成公网地址{A:b}并绑定，<strong>由于内网主机之前己经分别与地址为M,端口为n的公网主机以及地址为P,端口为q的公网主机通信</strong>，所以<strong>只有来自这两个公网地址和端口的分组才能到达内网主机</strong>。</p><h2 id="四对称型nat-csymmetric-nat-重点理解"><a class="markdownIt-Anchor" href="#四对称型nat-csymmetric-nat-重点理解"></a> （四）对称型NAT CSymmetric NAT)----重点理解</h2><h3 id="对称型nat把从同一内网地址和端口到相同的地址和端口的所有请求都映射到同一个公网地址和端口"><a class="markdownIt-Anchor" href="#对称型nat把从同一内网地址和端口到相同的地址和端口的所有请求都映射到同一个公网地址和端口"></a> 对称型NAT把从<strong>同一内网地址和端口****到相同的地址和端口的所有请求</strong>，<strong>都映射到同一个公网地址和端口</strong>。</h3><p>如果<strong>同一个内网主机，用相同的内网地址和端口向另一个地址发送数据分组，则会使用不同的映射</strong>，<strong>而且公网主机只有在接收到数据分组后，才能向与发送分组的内网主机进行通信</strong>。可见，对称性NAT是所有NAT类型中限制最为严格的。</p><p><img src="/images/javawz/1309518-20210520183858300-1646375177.png" alt="img"></p><p>在图中，对称型NAT会将内网地址{X:y}转换成公网地址{A:b}<strong>并绑定为{X:y}|{A:b}&lt;一&gt;{P:q}</strong>。这就意味着NAT只允许地址{A:b}接收来自{P:q}的分组，将它转给{X:y} 。<strong>当客户机请求一个不同的公网地址{M:n}时，NAT会新分配一个外部端口{<a href="https://www.baidu.com/s?wd=C%3A&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">C:</a>d}</strong> 。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一nat类型&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#一nat类型&quot;&gt;&lt;/a&gt; 一：NAT类型&lt;/h2&gt;
&lt;h3 id=&quot;基于udp的p2p应用需要考虑nat的类型因为不同的nat组合的穿透的方式并不一致有的能通-有的不能通-一般
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux设备检测外部网络NAT类型</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/Linux%E8%AE%BE%E5%A4%87%E6%A3%80%E6%B5%8B%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9CNAT%E7%B1%BB%E5%9E%8B/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/Linux设备检测外部网络NAT类型/</id>
    <published>2022-05-15T01:53:07.000Z</published>
    <updated>2022-05-15T01:53:45.132Z</updated>
    
    <content type="html"><![CDATA[<p>在异地组网的过程中发现，对称型NAT(Symmetric NAT)对P2P穿透的支持很不好，因此在搭建P2P穿透个人使用的客户端或服务器之前有必要搞清楚自己所在网络环境的NAT类型。<br>Windows设备的NAT类型检测工具网上一搜一大把，而Linux的检测工具比较难找，这里提供一种方法和教程。</p><p><strong>工具：pystun</strong><br>pystun是一个STUN客户端工具，用于获取局域网的NAT类型和公网IP。<br>A Python STUN client for getting NAT type and external IP (RFC 3489)</p><p><strong>环境：centos8.2（理论上其他Linux发行版本也可以）</strong><br><strong>注意：必须要用python2.x的环境（推荐2.7），python3.x会报错</strong></p><p>安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://files.pythonhosted.org/packages/a9/72/0b6a4f8ad71f72ed3b3946a21084a8b3c17de10ddc5fc0dfec43c48fc768/pystun-0.1.0.tar.gz</span><br></pre></td></tr></table></figure><p>可能有更新的版本，pystun下载地址：<a href="https://pypi.python.org/pypi/pystun" target="_blank" rel="noopener">https://pypi.python.org/pypi/pystun</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf pystun-0.1.0.tar.gz</span><br><span class="line">cd pystun-0.1.0/</span><br><span class="line">dnf install python2 -y</span><br><span class="line">python2 setup.py install</span><br></pre></td></tr></table></figure><p>如果出现下面的情况：</p><blockquote><p>Traceback (most recent call last): File “<a href="http://setup.py" target="_blank" rel="noopener">setup.py</a>”, line 2, in <module><br>from setuptools import setup, find_packages<br>ImportError: No module named setuptools</module></p></blockquote><p>centos：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf -y install python-setuptools</span><br></pre></td></tr></table></figure><p>ubuntu：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-setuptools</span><br></pre></td></tr></table></figure><p>就可以解决。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pystun</span><br></pre></td></tr></table></figure><p>如果用的是python3.x则会出现下面的错误：</p><blockquote><p>Traceback (most recent call last):<br>File “/usr/local/bin/pystun”, line 33, in<br>sys.exit(load_entry_point(‘pystun==0.1.0’, ‘console_scripts’, ‘pystun’)())<br>File “/usr/local/lib/python3.6/site-packages/pystun-0.1.0-py3.6.egg/stun/cli.py”, line 55, in main<br>stun_port=options.stun_port<br>File “/usr/local/lib/python3.6/site-packages/pystun-0.1.0-py3.6.egg/stun/<strong>init</strong>.py”, line 253, in get_ip_info<br>stun_host=stun_host, stun_port=stun_port)<br>File “/usr/local/lib/python3.6/site-packages/pystun-0.1.0-py3.6.egg/stun/<strong>init</strong>.py”, line 186, in get_nat_type<br>_initialize()<br>File “/usr/local/lib/python3.6/site-packages/pystun-0.1.0-py3.6.egg/stun/<strong>init</strong>.py”, line 93, in _initialize<br>dictValToAttr.update({items[i][1]: items[i][0]})<br>TypeError: ‘dict_items’ object does not support indexing</p></blockquote><p>运行正常：</p><blockquote><p>[root@iZbp1fn5lyz904h3d2r8pnZ ~]# pystun<br>NAT Type: Full Cone<br>External IP: <a href="http://121.196.xxx.xxx" target="_blank" rel="noopener">121.196.xxx.xxx</a><br>External Port: 5xxxx</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在异地组网的过程中发现，对称型NAT(Symmetric NAT)对P2P穿透的支持很不好，因此在搭建P2P穿透个人使用的客户端或服务器之前有必要搞清楚自己所在网络环境的NAT类型。&lt;br&gt;
Windows设备的NAT类型检测工具网上一搜一大把，而Linux的检测工具比较难
      
    
    </summary>
    
      <category term="linux" scheme="https://xiaowuyoucy.github.io/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>解决ubuntu18.04安装mysql5.7无法远程连接的问题</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/%E8%A7%A3%E5%86%B3ubuntu18-04%E5%AE%89%E8%A3%85mysql5-7%E6%97%A0%E6%B3%95%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/解决ubuntu18-04安装mysql5-7无法远程连接的问题/</id>
    <published>2022-05-15T01:48:31.000Z</published>
    <updated>2022-05-15T01:52:01.447Z</updated>
    
    <content type="html"><![CDATA[<p>遇到mysql本地连接成功,但远程连接不上的问题，无非从以下几个方面入手：</p><h2 id="1-user表问题"><a class="markdownIt-Anchor" href="#1-user表问题"></a> 1、user表问题</h2><p>mysql库中user表的root用户的host没有指定为%，而是默认的localhost，在mysql客户端执行如下操作即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1、切换到mysql库</span><br><span class="line">use mysql;</span><br><span class="line">#2、查看root用户的host是不是 %,如果是localhost继续下面操作</span><br><span class="line">select user,authentication_string,host from user where user = &apos;root&apos;;</span><br><span class="line"># %为任意主机，就是任意主机可以通过用户名root + 密码 进行连接，你也可以指定只允许某IP的主机进行连接</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;密码&apos;;</span><br><span class="line"># 如果之前没有密码，最好再设置下密码，发现上面语句不会产生密码，否则后面连接可能会提示无权限需要更新客户端</span><br><span class="line">alter user &apos;root&apos;@&apos;%&apos; identified with mysql_native_password by &apos;密码&apos;;</span><br><span class="line"># mysql重新加载用户权限</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="2-防火墙问题"><a class="markdownIt-Anchor" href="#2-防火墙问题"></a> 2、防火墙问题</h3><p>如果上面操作之后仍然无法远程连接mysql，就需要检查防火墙问题。我这里是ubuntu系统（其他系统自己找对应的指令）<br>首先查看了防火墙是否开启：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看防火墙状态</span><br><span class="line">ufw status</span><br></pre></td></tr></table></figure><p>发现并没有开启，因此排除防火墙问题。</p><h3 id="3-3306端口开放的问题"><a class="markdownIt-Anchor" href="#3-3306端口开放的问题"></a> 3、3306端口开放的问题</h3><p>如果3306端口没有开发也会导致无法远程连接，通过指令发现3306开放了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp</span><br></pre></td></tr></table></figure><p><img src="/images/javawz/2021093001031440.png" alt="解决ubuntu18.04安装mysql5.7无法远程连接的问题"></p><p>但是仔细看图，有一点奇怪，就是它开放的是<code>127.0.0.1:3306</code>而不是<code>0.0.0.0:3306</code>，这才是本次问题的突破点，<code>127.0.0.1:3306</code>只对本机开放访问，其他ip都不行，那么该怎么解决呢？重点来了~<br>1）由于是apt在线安装的，mysql在目录<code>/etc/mysql/mysql.conf.d</code>下有个默认配置文件<code>mysqld.cnf</code>，打开编辑发现：</p><p><img src="/images/javawz/2021093001095056.png" alt="解决ubuntu18.04安装mysql5.7无法远程连接的问题"></p><p>2）原来罪魁祸首就在这里，<code>bind-address</code>绑定的ip是<code>127.0.0.1</code>，我们只需将<code>127.0.0.1</code>改为<code>0.0.0.0</code>表示任意ip主机都能访问即可：</p><p><img src="/images/javawz/2021093001120039.png" alt="解决ubuntu18.04安装mysql5.7无法远程连接的问题"></p><p>3）最后，重启mysql服务即可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;遇到mysql本地连接成功,但远程连接不上的问题，无非从以下几个方面入手：&lt;/p&gt;
&lt;h2 id=&quot;1-user表问题&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-user表问题&quot;&gt;&lt;/a&gt; 1、user表问题&lt;/h2&gt;
&lt;p&gt;mysql库
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>解决wget不能下载https文件问题</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/%E8%A7%A3%E5%86%B3wget%E4%B8%8D%E8%83%BD%E4%B8%8B%E8%BD%BDhttps%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/解决wget不能下载https文件问题/</id>
    <published>2022-05-15T01:45:22.000Z</published>
    <updated>2022-05-15T01:47:07.546Z</updated>
    
    <content type="html"><![CDATA[<p>使用<a href="https://so.csdn.net/so/search?q=wget&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">wget</a>下载https协议的文件时遇到了这个问题，提示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR: cannot verify xx.xx.com&apos;s certificate, issued by `/C=BE/O=GlobalSign nv-sa/CN=GlobalSign Organization Validation CA - SHA256 - G2&apos;:</span><br><span class="line">  Unable to locally verify the issuer&apos;s authority.</span><br><span class="line">ERROR: certificate common name `*.alicdn.com&apos; doesn&apos;t match requested host name `xx.xx.com&apos;.</span><br><span class="line">To connect to xx.xx.com insecurely, use `--no-check-certificate&apos;.</span><br><span class="line">无法建立 SSL 连接。</span><br></pre></td></tr></table></figure><p>错误提示中建议使用“–no-check-certificate”参数，用法是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://xx.xx.com/xx.exe --no-check-certificate</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;使用&lt;a href=&quot;https://so.csdn.net/so/search?q=wget&amp;amp;spm=1001.2101.3001.7020&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;wget&lt;/a&gt;下载https协议的文件时遇到了这个问题，
      
    
    </summary>
    
      <category term="linux" scheme="https://xiaowuyoucy.github.io/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>ubuntu卸载Mysql</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/ubuntu%E5%8D%B8%E8%BD%BDMysql/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/ubuntu卸载Mysql/</id>
    <published>2022-05-15T01:43:33.000Z</published>
    <updated>2022-05-15T01:43:46.807Z</updated>
    
    <content type="html"><![CDATA[<h2 id="查看mysql依赖"><a class="markdownIt-Anchor" href="#查看mysql依赖"></a> 查看mysql依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list|grep mysql</span><br></pre></td></tr></table></figure><h2 id="卸载-mysql-common"><a class="markdownIt-Anchor" href="#卸载-mysql-common"></a> 卸载 mysql-common</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove mysql-common</span><br><span class="line">sudo apt-get autoremove --purge mysql-server-5.0</span><br></pre></td></tr></table></figure><h2 id="查看是否剩下mysql清除残留数据"><a class="markdownIt-Anchor" href="#查看是否剩下mysql清除残留数据"></a> 查看是否剩下mysql+清除残留数据</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list|grep mysql</span><br><span class="line">dpkg -l |grep ^rc|awk '&#123;print $2&#125;' |sudo xargs dpkg -P</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;查看mysql依赖&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#查看mysql依赖&quot;&gt;&lt;/a&gt; 查看mysql依赖&lt;/h2&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gu
      
    
    </summary>
    
      <category term="linux" scheme="https://xiaowuyoucy.github.io/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>mysql中文乱码问题</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/mysql%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/mysql中文乱码问题/</id>
    <published>2022-05-14T20:01:30.000Z</published>
    <updated>2022-05-15T01:41:24.082Z</updated>
    
    <content type="html"><![CDATA[<h3 id="mysql客户端的字符集"><a class="markdownIt-Anchor" href="#mysql客户端的字符集"></a> MYSQL客户端的字符集</h3><p>下面的测试均在test数据库中进行的:</p><p>实验步骤<br>使用两个linux客户端窗口, 一个用utf8登陆, 一个用gbk登陆</p><p>mysql数据库默认情况下是使用的utf8登陆的:</p><p>查看所有应用的字符集:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">show variables like &apos;character%&apos;;</span><br><span class="line"></span><br><span class="line">执行结果:</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | latin1                     |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br></pre></td></tr></table></figure><p>通过画图解释mysql的字符集问题:</p><p><img src="/images/javawz/image-20220515040327430.png" alt="image-20220515040327430"></p><p>客户端  ------  mysql服务端   ------ 数据库文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">character_set_client</span><br><span class="line">character_set_connection </span><br><span class="line">character_set_results  </span><br><span class="line">客户端使用的字符集, 都为utf8</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">此时执行:</span><br><span class="line">在utf8字符集环境下插入数据:</span><br><span class="line">insert into mytest values(5, &apos;小胡&apos;);</span><br><span class="line">select * from mytest;  ----正常显示</span><br></pre></td></tr></table></figure><p>接下来开启另一个linux客户端, 使用gbk字符集进行登陆:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456 --default_character_set=gbk </span><br><span class="line"></span><br><span class="line">切换到test用户下:</span><br><span class="line">查看所有应用的字符集:  </span><br><span class="line">show variables like &apos;character%&apos;;</span><br><span class="line"></span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | gbk                        |</span><br><span class="line">| character_set_connection | gbk                        |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | gbk                        |</span><br><span class="line">| character_set_server     | latin1                     |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+ </span><br><span class="line"></span><br><span class="line">此时客户端的字符集为: </span><br><span class="line">character_set_client  </span><br><span class="line">character_set_connection </span><br><span class="line">character_set_results  都为gbk.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select * from mytest:  --不能正常显示</span><br><span class="line"></span><br><span class="line">     在gbk环境下插入, 然后再到utf8环境下去查看同样也不能正常显示中文.</span><br></pre></td></tr></table></figure><p>总结:<br>1.   在utf8环境插入的中文不能用gbk查看;<br>2.   在gbk环境下插入的中文不能用utf8查看;<br>3.   在utf8环境下插入的中文要在utf8环境下查看;</p><ol start="4"><li>在gbk环境下插入的中文要在gbk环境下查看.</li></ol><h3 id="2-操作系统的语言集"><a class="markdownIt-Anchor" href="#2-操作系统的语言集"></a> 2 操作系统的语言集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/sysconfig/i18n</span><br><span class="line">显示: LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">操作系统的菜单按照zh_CN显示,  文件存储按照utf8</span><br><span class="line"></span><br><span class="line">linux操作系统语言环境 和 用户的配置的语言环境LANG 相互影响</span><br><span class="line">echo $LANG   -----&gt;zh_CN.UTF-8</span><br><span class="line">  </span><br><span class="line">修改用户下的.bash_profile 中的LANG，屏蔽操作系统的LANG设置或者export LANG=C临时设置也可以</span><br><span class="line">然后在登陆到mysql数据库上:</span><br><span class="line">登陆数据库:   </span><br><span class="line">mysql -uroot -p123456 </span><br><span class="line">use test</span><br><span class="line">show variables like &apos;character%&apos;</span><br><span class="line"></span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | latin1                     |</span><br><span class="line">| character_set_connection | latin1                     |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | latin1                     |</span><br><span class="line">| character_set_server     | latin1                     |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line"></span><br><span class="line">再次查看mytest表, 不能正常显示中文</span><br><span class="line">select * from mytest;</span><br></pre></td></tr></table></figure><h3 id="3-linux客户端的字符集"><a class="markdownIt-Anchor" href="#3-linux客户端的字符集"></a> 3 linux客户端的字符集</h3><p>若将linux客户端设置问GB18030, 则也会对中文的显示产生影响:</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;mysql客户端的字符集&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#mysql客户端的字符集&quot;&gt;&lt;/a&gt; MYSQL客户端的字符集&lt;/h3&gt;
&lt;p&gt;下面的测试均在test数据库中进行的:&lt;/p&gt;
&lt;p&gt;实验步骤&lt;br&gt;
使用两个li
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>mysql表的约束</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/mysql%E8%A1%A8%E7%9A%84%E7%BA%A6%E6%9D%9F/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/mysql表的约束/</id>
    <published>2022-05-14T19:33:15.000Z</published>
    <updated>2022-05-14T19:38:04.545Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*定义主键约束　primary key:不允许为空，不允许重复</span><br><span class="line">*定义主键自动增长　auto_increment</span><br><span class="line">*定义唯一约束　unique</span><br><span class="line">*定义非空约束　not null</span><br><span class="line">*定义外键约束　constraint ordersid_FK foreign key(ordersid) references orders(id)</span><br><span class="line">*删除主键：alter table tablename drop primary key ;</span><br></pre></td></tr></table></figure><p>准备两个表:(下面的建表语句在执行的时候若不能正常执行, 可以尝试把tab去掉)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table class (</span><br><span class="line">id INT(11) primary key auto_increment,</span><br><span class="line">name varchar(20) unique</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table student (</span><br><span class="line">id INT(11) primary key auto_increment, </span><br><span class="line">name varchar(20) unique,</span><br><span class="line">passwd varchar(15) not null,</span><br><span class="line">classid INT(11),</span><br><span class="line">constraint stu_classid_FK foreign key(classid) references class(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>向class表中插入两条数据:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">insert into class(name) values(&apos;音乐&apos;);</span><br><span class="line">insert into class(name) values(&apos;体育&apos;);</span><br><span class="line">insert into class(id, name) values(5, &apos;美术&apos;);</span><br><span class="line">insert into class(name) values(&apos;文化&apos;);</span><br><span class="line"></span><br><span class="line">注意: 要插入的是部分列, 一定要在class表名后面写上列名, 表示要插入哪些列</span><br><span class="line">      由于class表的id是主键, 可以不用显示的插入主键的值, mysql会自动插入,而且会自动增长,确保不会重复.</span><br></pre></td></tr></table></figure><p>向student表中插入数据:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> 正常插入一条记录:</span><br><span class="line">insert into student(name, passwd, classid) values(&apos;xiaohong&apos;, &apos;xxxxxx&apos;, 1);</span><br><span class="line"></span><br><span class="line">1 测试主键的非空性</span><br><span class="line">insert into student(id, name, passwd, classid) values(null, &apos;xiaowen&apos;, &apos;xxxxxx&apos;, 1);</span><br><span class="line">注意: 若给主键插入一个null, mysql会自动插入一个有效的值, 所以mysql的主键肯定不会为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2 测试主键的唯一性约束</span><br><span class="line">insert into student(id, name, passwd, classid) values(1, &apos;xiaoliu&apos;, &apos;xxxxxx&apos;, 1);</span><br><span class="line">-----&gt;ERROR 1062 (23000): Duplicate entry &apos;1&apos; for key &apos;PRIMARY&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3 测试name列的唯一性</span><br><span class="line">insert into student(name, passwd, classid) values(&apos;xiaohong&apos;, &apos;xxxxxx&apos;, 2);</span><br><span class="line">-----&gt; ERROR 1062 (23000): Duplicate entry &apos;xiaohong&apos; for key &apos;name&apos;</span><br><span class="line"></span><br><span class="line">insert into student(name, passwd, classid) values(null, &apos;xxxxxx&apos;, 2);</span><br><span class="line">注意: name为unique约束, 只是不能重复, 但是可以为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4 测试passwd的非空约束</span><br><span class="line">insert into student(name, passwd, classid) values(&apos;xiaohua&apos;, null, 2);</span><br><span class="line">-----&gt; ERROR 1048 (23000): Column &apos;passwd&apos; cannot be null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5 测试classid的外键约束</span><br><span class="line">insert into student(name, passwd, classid) values(&apos;meizi&apos;, &apos;mmmm&apos;, 10);</span><br><span class="line">-----&gt;OREIGN KEY (`classid`) REFERENCES `class` (`id`))</span><br><span class="line">在class表中没有id为10的列的值.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>mysql自连接</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/mysql%E8%87%AA%E8%BF%9E%E6%8E%A5/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/mysql自连接/</id>
    <published>2022-05-14T19:23:37.000Z</published>
    <updated>2022-05-14T19:25:08.859Z</updated>
    
    <content type="html"><![CDATA[<p>自连接:</p><p>查询员工、老板信息，显示: xxx的老板是yyy</p><p>分析: 可以将emp表当成两个表来用, 一个是员工表 e, 一个是老板表 b</p><p>1 mysql不支持用||连接两个字符串</p><p>2 使用concat函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select concat(e.ename, &apos;的老板是&apos;, b.ename) from emp e, emp b where e.mgr=b.empno;</span><br><span class="line">select concat(e.ename, &apos;的老板是&apos;, b.ename) from emp e inner join emp b on e.mgr=b.empno;</span><br></pre></td></tr></table></figure><p>3 若要显示KING的信息, 需要使用外连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a mysql不支持nvl函数</span><br><span class="line"></span><br><span class="line">b 使用ifnull函数</span><br><span class="line">左外连接:</span><br><span class="line">select concat(e.ename, &apos;的老板是&apos;, b.ename) from emp e left outer join emp b on e.mgr=b.empno;</span><br><span class="line">select concat(e.ename, &apos;的老板是&apos;, ifnull(b.ename, &apos;HIMSELF&apos;)) from emp e left outer join emp b on e.mgr=b.empno;</span><br><span class="line">右外连接:</span><br><span class="line">select concat(e.ename, &apos;的老板是&apos;, ifnull(b.ename, &apos;HIMSELF&apos;)) from emp b right outer join emp e on e.mgr=b.empno;</span><br></pre></td></tr></table></figure><p>​</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;自连接:&lt;/p&gt;
&lt;p&gt;查询员工、老板信息，显示: xxx的老板是yyy&lt;/p&gt;
&lt;p&gt;分析: 可以将emp表当成两个表来用, 一个是员工表 e, 一个是老板表 b&lt;/p&gt;
&lt;p&gt;1 mysql不支持用||连接两个字符串&lt;/p&gt;
&lt;p&gt;2 使用concat函数&lt;/p&gt;
&lt;f
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>多表查询</title>
    <link href="https://xiaowuyoucy.github.io/2022/05/15/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/"/>
    <id>https://xiaowuyoucy.github.io/2022/05/15/多表查询/</id>
    <published>2022-05-14T19:05:24.000Z</published>
    <updated>2022-05-14T19:10:21.615Z</updated>
    
    <content type="html"><![CDATA[<p>执行sql脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source 脚本名.sql</span><br><span class="line"></span><br><span class="line">source scott_data.sql</span><br></pre></td></tr></table></figure><p>2 交叉连接—相当于笛卡尔积</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.*, d.* from emp e cross join dept d;</span><br></pre></td></tr></table></figure><p>3 自连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查询emp表和dept表的所有信息: </span><br><span class="line">SQL99: </span><br><span class="line"> select e.*, d.* from emp e inner join dept d on e.deptno=d.deptno;</span><br><span class="line"> 其中inner可以省略</span><br><span class="line"> </span><br><span class="line">oracle写法: </span><br><span class="line"> select e.*, d.* from emp e, dept d where e.deptno=d.deptno;</span><br><span class="line"> 总结: </span><br><span class="line">           [,]----&gt;[inner join]</span><br><span class="line">        [where]-----&gt;[on]</span><br><span class="line"></span><br><span class="line">注意: 不能显示40号部门的信息, 此时需要使用外连接</span><br></pre></td></tr></table></figure><p>4 外连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 左外连接:</span><br><span class="line">  select e.*, d.* from emp e right outer join dept d on e.deptno=d.deptno;</span><br><span class="line">  </span><br><span class="line">  右外连接:</span><br><span class="line">select e.*, d.* from dept d left outer join emp e on e.deptno=d.deptno;</span><br><span class="line"></span><br><span class="line">【注意】SQL99中，外链接取值与关系表达式=号左右位置无关。取值跟from后表的书写顺序有关。 </span><br><span class="line">&quot;xxx left outer join yyy&quot;  则为取出xxx的内容。</span><br><span class="line">&quot;xxx right outer join yyy&quot; 则为取出yyy的内容</span><br></pre></td></tr></table></figure><p>对比练习:</p><p>1 查询员工信息,员工号,姓名,月薪,部门名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">select e.empno, e.ename, e.sal, d.dname from emp e inner join dept d on e.deptno=d.deptno;</span><br><span class="line">select e.empno, e.ename, e.sal, d.dname from emp e, dept d where e.deptno=d.deptno;</span><br><span class="line"></span><br><span class="line">[,] ----&gt;inner join</span><br><span class="line">[where] -----&gt;on</span><br></pre></td></tr></table></figure><p>2 统计各个部门员工总人数-要求显示部门名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">select d.deptno, d.dname, count(e.empno) from emp e inner join dept d on e.deptno=d.deptno group by d.deptno, d.dname;</span><br><span class="line">  </span><br><span class="line">select d.deptno, d.dname, count(e.empno) from emp e,  dept d where e.deptno=d.deptno group by d.deptno, d.dname;</span><br><span class="line"></span><br><span class="line">显示40号部门的信息----需要使用外连接</span><br><span class="line">oracle的写法: ----不支持</span><br><span class="line">select d.deptno, d.dname, count(e.empno) from emp e, dept d where e.deptno(+)=d.deptno group by d.deptno; ---不支持此种写法</span><br><span class="line"></span><br><span class="line">外连接:</span><br><span class="line">右外连接:</span><br><span class="line">select d.deptno, d.dname, count(e.empno) from emp e right outer join dept d on e.deptno=d.deptno group by d.deptno, d.dname;</span><br><span class="line"></span><br><span class="line">左外连接:</span><br><span class="line">SELECT d.deptno, d.dname, COUNT(e.empno) FROM dept d LEFT OUTER JOIN emp e ON e.deptno=d.deptno GROUP BY d.deptno, d.dname;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">与oracle比较:</span><br><span class="line">  mysql不支持oracle那样的外连接的写法, 需要使用right | left [outer] join 的写法</span><br><span class="line">  ,----&gt;right|left [outer] join</span><br><span class="line">  where----&gt;on</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;执行sql脚本&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;
      
    
    </summary>
    
      <category term="数据库" scheme="https://xiaowuyoucy.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
  </entry>
  
</feed>
