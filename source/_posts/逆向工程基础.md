---
title: 逆向工程基础
date: 2022-07-10 17:21:30
tags:
categories: 逆向工程
doc:
---

# 关于逆向工程

### 逆向工程（Reverse Engineering，简称RE)

### 代码逆向工程（Reverse Code Engineering，简称RCE）

#### 逆向分析法

- 静态分析法
  - 在不执行代码文件的情形下，对代码进行静态分析的一种方法。
- 动态分析法
  - 在程序文件的执行过程中对代码进行动态分析

Hex Editor是一个简单易用的工具，使用它可以轻松地把二进制文件转换为十六进制文件。

![image-20220710181629406](/images/javawz/image-20220710181629406.png)

#### “打补丁”与“破解”

对应用程序文件或进程内存内容的更改被称为“打补丁”（Patch），“破解”（Crack）与其含义类似





# 逆向分析Hello World！程序

OllyDbg: http://www.ollydbg.de

OllyDbg是一种强大的Win32调试工具

![image-20220710182151607](/images/javawz/image-20220710182151607.png)



### 入口点

EP是Windows可执行文件（EXE、DLL、SYS等）的代码入口点，是执行应用程序时最先执行的代码的起始位置，它依赖于CPU。

调试器停止的地点即为HelloWorld.exe执行的起始地址，它是一段EP （EntryPoint，入口点）代码。

地址：进程的虚拟内存地址（Virtual Address， VA）
指令：IA32 （或x86） CPU指令
反汇编代码：将OP code转换为便于查看的汇编指令
注释：调试器添加的注释（根据选项不同，显示的注释略有不同）



### OllyDbg基本指令

```
F2：				设置断点/取消断点

F7：				单步步入

F8：				单步执行

Ctrl + F2：		重新调试

Ctrl+G：			跳转到指定地址（查看代码时使用，非运行时命令）

F9：				运行（遇到断点时暂停）

Ctrl+F9：		执行函数代码内的命令，直到遇到RETN命令，用于跳出函数体

F4：				执行到光标所在位置（直接转到要调试的位置）

;  	  			添加注释

:	  			添加标签

*    			 显示当前EIP(命令指针)位置

-     			显示上一个光标位置

Enter：			若光标处有CALL/JMP等指令，则跟踪并显示相关地址（运行时不可用，简单查看函数内容时非常有用）

空格键：			编辑汇编代码
```



### 设置“大本营”的四种方法

#### 1.Goto命令

执行Go to（Ctrl+G）命令

![image-20220710195834481](/images/javawz/image-20220710195834481.png)



#### 2.设置断点

在OllyDbg菜单栏中依次选择View-Breakpoints选项（快捷键（ALT+B）），打开Breakpoints对话框，列出代码中设置的断点

![image-20220710200136557](/images/javawz/image-20220710200136557.png)

在断点列表中双击某个断点会直接跳转到相应位置。



#### 3.注释

按键盘上的“；”键可以在指定地址处添加注释，还可以通过查找命令找到它。

在鼠标右键菜单中依次选择Search for-User defined comment，这样就能看到用户输入的所有注释

![image-20220710200340518](/images/javawz/image-20220710200340518.png)

双击相应注释，光标将自动定位到相应位置。





#### 4.标签

单击鼠标右键，依次选择Search forlUser defined labels菜单即可打开User defined labels窗口，该窗口列出了用户设置的标签

在User defined labels窗口中双击某个标签，光标即移动到相应位置。

![image-20220710200640747](/images/javawz/image-20220710200640747.png)

![image-20220710200714534](/images/javawz/image-20220710200714534.png)



### 快速查找指定代码的四种方法

1.代码执行法



2.字符串检索法

鼠标右键菜单-Search for-All referenced text strings

![image-20220710201316743](/images/javawz/image-20220710201316743.png)

双击字符串，光标定位到使用该字符串的指令处

VC++中， static字符串会被默认保存为Unicode码形式， static字符串是指在程序内部被硬编码（Hard Coding）的字符串。



#### API检索法（1）：在调用代码中设置断点

鼠标右键菜单-Search for-All intermodular calls

![image-20220710201618956](/images/javawz/image-20220710201618956.png)

双击它，光标即定位到调用它的地址处



#### API检索法（2）：在API代码中设置断点

鼠标右键菜单-Search for-Name in all calls





在OllyDbg菜单栏中依次选择View-Memory菜单（快捷键Alt+M），打开内存映射窗口。内存映射窗口中显示了一部分HelloWorld.exe进程内存。在图底部的方框中可以看到，USER32库被加载到了内存。

![image-20220710202412666](/images/javawz/image-20220710202412666.png)

使用OllyDbg中的Name in all modules命令可以列出被加载的DLL文件中提供的所有API。使用Name in all modules命令打开All names窗口，单击Name栏目按名称排序，通过键盘敲出MessageBoxW后，光标会自动定位到MessageBoxW上

![image-20220710203219441](/images/javawz/image-20220710203219441.png)

双击MessageBoxW函数后就会显示其代码，它实现于USER32.dl1库中

![image-20220710203502389](/images/javawz/image-20220710203502389.png)

模块中的地址和本程序的地址是完全不同的。

### 修改字符串的两种方法

#### 1.直接修改字符串缓冲区

在Dump窗口中按Ctrl+G快捷键执行Go to命令，在弹出窗口中输入地址进入字符串缓冲区。然后使用鼠标选中地址处的字符串，按Ctrl+E快捷键打开编辑窗口

![image-20220710220035154](/images/javawz/image-20220710220035154.png)

注意:
若新字符串长度大于原有字符串，执行覆盖操作时可能损坏字符串后面的数据，所以一定要小心。特别是字符串后面有非常重要的数据时，覆盖操作导致数据损坏就会引发程序内存引用错误。

新字符串的长度不应比原字符串长。

#### 保存更改到可执行文件

选中更改后的“Hello Reversing”字符串，单击鼠标右键，在弹出的菜单中选择Copy to executable file菜单

![image-20220710220428077](/images/javawz/image-20220710220428077.png)

在弹出的Hex窗口中单击鼠标右键，选择Save file菜单，在Save file as对话框中输人文件名“Hello Reversing.exe”后保存为.exe可执行文件。



2.在其他内存区域新建字符串并传递给消息函数



![image-20220710220905979](/images/javawz/image-20220710220905979.png)



![image-20220710220921112](/images/javawz/image-20220710220921112.png)





![image-20220710220933154](/images/javawz/image-20220710220933154.png)





![image-20220710220950573](/images/javawz/image-20220710220950573.png)