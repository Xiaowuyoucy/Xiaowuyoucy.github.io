---
title: 文件操作
date: 2021-06-29 09:27:59
tags:
categories: c++
doc:
---

# 文本文件操作

![1624931175526](/images/javawz/1624931175526.png)





ifstream类，它是从istream类派生的，用来支持从磁盘文件的输入。
ofstream类，它是从ostream类派生的，用来支持向磁盘文件的输出。
fstream类，它是从iostream类派生的，用来支持对磁盘文件的输入输出。

### 文件的打开与关闭

#### 打开文件

所谓打开(open)文件是一种形象的说法，如同打开房门就可以进入房间活
动一样。
打开文件是指在文件读写之前做必要的准备工作，包括：

1）为文件流对象和指定的磁盘文件建立关联，以便使文件流流向指定的磁盘
文件。

2）指定文件的工作方式，如，该文件是作为输入文件还是输出文件，是ASCII
文件还是二进制文件等。
以上工作可以通过两种不同的方法实现。

1)
调用文件流的成员函数open。如
ofstream outfile; //定义ofstream类(输出文件流类)对象outfile
outfile.open("f1.dat",ios::out); //使文件流与f1.dat文件建立关联
第2行是调用输出文件流的成员函数open打开磁盘文件f1.dat，并指定它为输出
文件，
文件流对象ouFile将向磁盘文件f1.dat输出数据。ios::out是I/O模式的一
种，表示以输出方式打开一个文件。或者简单地说，此时f1.dat是一个输出文
件，接收从内存输出的数据。
调用成员函数open的一般形式为：
文件流对象.open(磁盘文件名, 输入输出方式);
磁盘文件名可以包括路径，如"c:\new\\f1.dat"，如缺省路径，则默认为当
前目录下的文件。

2)
在定义文件流对象时指定参数
在声明文件流类时定义了带参数的构造函数，其中包含了打开磁盘文件
的功能。因此，可以在定义文件流对象时指定参数，调用文件流类的构造函数

![1624930197915](/images/javawz/1624930197915.png)

几点说明：

1) 新版本的I/O类库中不提供ios::nocreate和ios::noreplace。

2) 每一个打开的文件都有一个文件指针，该指针的初始位置由I/O方式指定，
每次读写都从文件指针的当前位置开始。每读入一个字节，指针就后移一个字
节。当文 件指针移到最后，就会遇到文件结束EOF（文件结束符也占一个字节，
其值为-1)，此时流对象的成员函数eof的值为非0值(一般设为1)，表示文件结
束 了。

3) 可以用“位或”运算符“|”对输入输出方式进行组合，如表13.6中最后3行
所示那样。还可以举出下面一些例子：
ios::in | ios:: noreplace //打开一个输入文件，若文件不存在则返回打开失
败的信息
ios::app | ios::nocreate //打开一个输出文件，在文件尾接着写数据，若文件不存在，则返回打开失败的信息
ios::out l ios::noreplace //打开一个新文件作为输出文件，如果文件已存
在则返回打开失败的信息
ios::in l ios::out I ios::binary //打开一个二进制文件，可读可写
但不能组合互相排斥的方式，如 ios::nocreate l ios::noreplace。

4) 如果打开操作失败，open函数的返回值为0(假)，如果是用调用构造函数的
方式打开文件的，则流对象的值为0。可以据此测试打开是否成功。如
if(outfile.open("f1.bat", ios::app) ==0)
cout <<"open error";
或
if( !outfile.open("f1.bat", ios::app) )
cout <<"open error";

#### 关闭文件

在对已打开的磁盘文件的读写操作完成后，应关闭该文件。关闭文件用
成员函数close。如
ouFile.close();
//将输出文件流所关联的磁盘文件关闭
所谓关闭，实际上是解除该磁盘文件与文件流的关联，原来设置的工作方式也
失效，这样，就不能再通过文件流对该文件进行输入或输出。此时可以将文件
流与其他磁盘文件建立关联，通过文件流对新的文件进行输入或输出。如
ouFile.open("f2.dat",ios::app|ios::nocreate);
此时文件流ouFile与f2.dat建立关联，并指定了f2.dat的工作方式。

### C++对ASCII文件的读写操作

如果文件的每一个字节中均以ASCII代码形式存放数据,即一个字节存放一
个字符,这个文件就是ASCII文件(或称字符文件)。程序可以从ASCII文件中读入若
干个字符,也可以向它输出一些字符。

1)
用流插入运算符`<<`和流提取运算符`>>`输入输出标准类型的数据。`<<`
和`>>`都已在iostream中被重载为能用于ostream和istream类对象的标准类型的
输入输出。由于ifstream和
ofstream分别是ostream和istream类的派生类；因此
它们从ostream和istream类继承了公用的重载函数，所以在对磁盘文件的操作
中，可以通过文件流对象和流插入运算符`<<`及
流提取运算符`>>`实现对磁盘
文件的读写，如同用cin、cout和<<、>>对标准设备进行读写一样。

2)
用文件流的put、get、geiline等成员函数进行字符的输入输出，：用C++
流成员函数put输出单个字符、C++
get()函数读入一个字符和C++
getline()函数读
入一行字符。

```cpp
#define _CRT_SECURE_NO_WARNINGS
#include<iostream>
#include<fstream>

using namespace std;

void test01() {
	
	char sourceFileName[] = "source.txt";
	char destFileName[] = "dest.txt";

	//方式1
	//用构造函数打开文件

	//ifstream fin(sourceFileName,ios::in); //打开输入文件
	//ofstream fout(destFileName,ios::out); //打开输出文件

	//方式2
	ifstream fin;
	ofstream fout;

	fin.open(sourceFileName,ios::in);
	//以写追加模式打开文件
	fout.open(destFileName,ios::out | ios::app);

	//判断文件是否打开成功
	//这里
	if (!fin || !fout)
	{
		cout << "打开文件失败" << endl;
		return;

	}
	char ch;
	while (fin.get(ch))
	{
		fout << ch;
		//fout.put(ch); //输出一个字符到文件里
	}

	//关闭文件
	fin.close();
	fout.close();

}

int main(char *argv[], int argc)
{
	test01();

	return 0;
}

```

# C++对二进制文件的读写操作

### 文本模式

在linux系统平台下是以`\n`作为换行符的

在windows系统平台下是以`\r\n`作为换行符

文本模式和二进制模式在Linux下是不区分的,但在windows模式下是区分的,因为windows模式下的换行符`\r\n`要进行转换

### 二进制模式

不进行编码转换,将内存中的内容原封不动的输出到文件或将内容原封不动的输入到内存中

1.用ios::binary模式打开文件

2.以二进制方式写到文件

​	对象名.write(地址,要写入的字节大小)

3.以二进制方式读到内存

​	对象名.read(地址,要读入的字节大小)

```cpp

#define _CRT_SECURE_NO_WARNINGS
#include<iostream>
#include<fstream>

using namespace std;

class Person {
public:
	Person() {
		m_Age = 0;
		strcpy(m_Name,"");
	}

	Person(const char * name, int age) {
		m_Age = age;

		strcpy(m_Name, name);

	}



	void show() {
		cout << m_Name << "  " << m_Age << endl;
	}

	int m_Age;
	char m_Name[50];
};


void test01() {

	Person p1("小明", 18);
	Person p2("小花", 16);


	char fileName[] = "binary.txt";

	//以二进制方式打开文件
	ofstream fout(fileName, ios::out | ios::binary);
	ifstream fin(fileName, ios::in | ios::binary);


	if (!fin || !fout) {
		cout << "文件打开失败" << endl;
		return;
	}

	//写二进制文件,首位参数需要转换类型为char *
	fout.write((char *) &p1,sizeof(p1));
	fout.write((char *) &p2,sizeof(p2));
	fout.close();

	Person tP1, tP2;

	//读二进制文件,首位参数需要转换类型为char *
	fin.read((char *)&tP1,sizeof(tP1));
	fin.read((char *)&tP2,sizeof(tP2));
	
	//显示输出
	tP1.show();
	tP2.show();

	fin.close();

}
int main(char *argv[], int argc)
{
	test01();

	return 0;
}

```

