---
title: 深拷贝和浅拷贝
date: 2021-04-26 21:22:10
tags:
categories: c++
doc:
---

# 深拷贝和浅拷贝

字符串如果进行浅拷贝会出现以下问题:

假设有两个char类型指针a,b指向同一个内存空间

当a被释放时,b还未修改,再次使用b时就会出现段错误(Linux)或内存中断(windows)

```c++
#include<iostream>

using namespace std;

class Teacher {

public:
	Teacher() {
		m_id = 0;
		m_name = NULL;
	}
	//有参构造函数,开辟一个空间给m_name
	Teacher(int id,const char * name)
	{
		int len = strlen(name);
		m_name = (char *)malloc(len + 1);
		strcpy(m_name, name);
		m_id = id;
	}
	//拷贝构造函数,开辟一个空间
	Teacher(const Teacher & another)
	{
		cout << "Teacher(const Teacher & another).." << endl;
		int len = strlen(another.m_name);
		this->m_name = (char *)malloc(len + 1);
		strcpy(this->m_name, another.m_name);
		this->m_id = another.m_id;
	}
	//打印id 和name和name的地址
	void print() {
		cout << m_id << endl;
		cout << m_name << endl;
		cout << (int *)m_name << endl;
		cout << "================================================" << endl;

	}


	//释放从堆区开辟的内存
	~Teacher()
	{
		if (m_name != NULL)
		{
			cout << m_name << "  ";
			free(m_name);
			m_name = NULL;
			cout << "free" << endl;
			cout << "================================================" <<endl;
		}
	}
private:
	int m_id;
	char * m_name;

};

void test1()
{
	Teacher tc1(123, "xiaoh");

	Teacher tc2(tc1);

	tc1.print();
	tc2.print();

}

int main(int argc, char* argv[])
{
	test1();
	return 0;
}



```

