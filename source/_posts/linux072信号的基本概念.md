---
title: 信号的基本概念
date: 2022-01-20 16:51:19
tags:
categories: linux
doc:
---

## 信号介绍

- 信号的概念

信号是信息的载体，Linux/UNIX 环境下，古老、经典的通信方式， 现下依然是主要的通信手段。

- 信号在我们的生活中随处可见，例如：

  - 古代战争中摔杯为号；
  - 现代战争中的信号弹;

  - 体育比赛中使用的信号枪......

    

- 信号的特点
  - 简单
  - 不能携带大量信息
  - 满足某个特点条件才会产生

## 2 信号的机制

进程A给进程B发送信号，进程B收到信号之前执行自己的代码，收到信号后，不管执行到程序的什么位置，都要暂停运行，去处理信号，处理完毕后再继续执行。与硬件中断类似——异步模式。但信号是软件层面上实现的中断，早期常被称为“软中断”。

`每个进程收到的所有信号，都是由内核负责发送的。`

进程A给进程B发送信号示意图：

![img](/images/javawz/wps6534.tmp.jpg) 



![image-20220120172232030](/images/javawz/image-20220120172232030.png)

### 2.1信号的状态

信号有三种状态：产生、未决和递达。

- 信号的产生

  - 按键产生，如：Ctrl+c(终止进程SIGINT)、Ctrl+z(挂起进程SIGTSTP)、Ctrl+\\(退出进程SIGQUIT)
  - 系统调用产生，如：kill、raise、abort
  - 软件条件产生，如：定时器alarm
  - 硬件异常产生，如：非法访问内存(段错误)、除0(浮点数例外)、内存对齐出错(总线错误)
  - 命令产生，如：kill命令

  

- 未决：产生和递达之间的状态。主要由于阻塞(屏蔽)导致该状态。 

- 递达：递送并且到达进程。

### 2.2 信号的处理方式

- 执行默认动作 

- 忽略信号(丢弃不处理)

- 捕捉信号(调用用户的自定义的处理函数)

### 2.3 信号的特质

信号的实现手段导致信号`有很强的延时性`，但对于用户来说，时间非常短，不易察觉。

Linux内核的进程控制块PCB是一个结构体，task_struct, 除了包含进程id，状态，工作目录，用户id，组id，文件描述符表，还包含了信号相关的信息，主要指**阻塞信号集和未决信号集**。

注:表示PCB的task_struct结构体定义在：

```
 /usr/src/linux-headers-4.4.0-97/include/linux/sched.h:1390
```

### 2.4 阻塞信号集和未决信号集

  Linux内核的进程控制块PCB是一个结构体，这个结构体里面包含了信号相关的信息，主要有阻塞信号集和未决信号集。

- 阻塞信号集中保存的都是被当前进程阻塞的信号。若当前进程收到的是阻塞信号集中的某些信号，这些信号需要暂时被阻塞，不予处理。

- 信号产生后由于某些原因(主要是阻塞)不能抵达，这类信号的集合称之为未决信号集。在屏蔽解除前，信号一直处于未决状态；若是信号从阻塞信号集中解除阻塞，则该信号会被处理，并从未决信号集中去除。

### 2.5信号的四要素

- 通过`man 7 signal`可以查看信号相关信息
- 信号编号
- 信号的名字
- 信号的默认处理(默认终止进程)
- 信号如何产生

#### 1 信号的编号

使用kill -l命令可以查看当前系统有哪些信号，不存在编号为0的信号。其中1-31号信号称之为常规信号（也叫普通信号或标准信号），34-64称之为实时信号，驱动编程与硬件相关。

#### 2 信号的名称

#### 3 产生信号的事件

#### 4信号的默认处理动作

**Term**：终止进程

**Ign**：忽略信号 (默认即时对该种信号忽略操作)

**Core**：终止进程，生成Core文件。(查验死亡原因，用于gdb调试)

**Stop**：停止（暂停）进程

**Cont**：继续运行进程

-  特别需要注意的是：The signals SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.(无法捕获、阻止或忽略信号SIGKILL和SIGSTOP。)

-  几个常用到的信号

```
SIGINT、SIGQUIT、SIGKILL、SIGSEGV、SIGUSR1、SIGUSR2、SIGPIPE、SIGALRM、SIGTERM、SIGCHLD、SIGSTOP、SIGCONT

SIGHUP        1       A     在控制终端上是挂起信号, 或者控制进程结束
SIGINT        2       A     从键盘输入的中断
SIGQUIT       3       C     从键盘输入的退出
SIGILL        4       C     无效硬件指令
SIGABRT       6       C     非正常终止, 可能来自 abort(3)
SIGFPE        8       C     浮点运算例外
SIGKILL       9      AEF    杀死进程信号
SIGSEGV      11       C     无效的内存引用
SIGPIPE      13       A     管道中止: 写入已经关闭读取的管道
SIGALRM      14       A     来自 alarm(2) 的超时信号
SIGTERM      15       A     终止信号
SIGUSR1   30,10,16    A     用户定义的信号 1
SIGUSR2   31,12,17    A     用户定义的信号 2
SIGCHLD   20,17,18    B     子进程结束或停止
SIGCONT   19,18,25          继续停止的进程
SIGSTOP   17,19,23   DEF    停止进程
SIGTSTP   18,20,24    D     终端上发出的停止信号
SIGTERM      15       A     终止信号
SIGUSR1   30,10,16    A     用户定义的信号 1
SIGUSR2   31,12,17    A     用户定义的信号 2
SIGCHLD   20,17,18    B     子进程结束或停止
SIGFPE        8       C     浮点运算例外
SIGABRT       6       C     非正常终止, 可能来自 abort(3)
SIGQUIT       3       C     从键盘输入的退出
SIGILL        4       C     无效硬件指令
SIGABRT       6       C     非正常终止, 可能来自 abort(3)
SIGFPE        8       C     浮点运算例外
SIGKILL       9      AEF    杀死进程信号
SIGSEGV      11       C     无效的内存引用
SIGPIPE      13       A     管道中止: 写入无人读取的管道
SIGALRM      14       A     来自 alarm(2) 的超时信号
SIGTERM      15       A     终止信号
SIGUSR1   30,10,16    A     用户定义的信号 1
SIGUSR2   31,12,17    A     用户定义的信号 2
SIGCHLD   20,17,18    B     子进程结束或停止
SIGCONT   19,18,25          继续停止的进程
SIGSTOP   17,19,23   DEF    停止进程
SIGTSTP   18,20,24    D     终端上发出的停止信号
SIGTTIN   21,21,26    D     后台进程试图从控制终端(tty)输入
SIGTTOU   22,22,27    D     后台进程试图在控制终端(tty)输出

```

